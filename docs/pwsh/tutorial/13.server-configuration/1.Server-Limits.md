---
title: Server Limits
parent: Server Configuration
nav_order: 1
---

# Server Limits

Fine‑tune resource & safety thresholds using `Set-KrServerLimit`.

> Prerequisites: basic hosting in [Endpoints](../7.endpoints/index) and route basics in [Routes](../2.routes/index).

## Full source

File: [`pwsh/tutorial/examples/13.1-Server-Limits.ps1`][13.1-Server-Limits.ps1]

```powershell
{% include examples/pwsh/13.1-Server-Limits.ps1 %}
```

## Step-by-step

1. Create server + listener.
2. Add runtime.
3. Apply limits (here: body size, headers size, keep-alive, and `MaxConcurrentConnections 1`).
4. Enable configuration (commits listeners + runtime + limits).
5. Map a long-running `/info` route (includes `Start-Sleep 20` to simulate work).
6. Start server.

## Common settings

| Setting                    | Why                        |
| -------------------------- | -------------------------- |
| MaxRequestBodySize         | Reject large uploads early |
| MaxConcurrentConnections   | Basic throttling           |
| KeepAliveTimeoutSeconds    | Trim idle sockets          |
| MaxRequestHeadersTotalSize | Protect from header abuse  |
| MinRequestBodyDataRate     | Drop very slow clients     |

## Try it

Open two separate PowerShell terminals (or run jobs) and issue the request simultaneously
to observe the single concurrent connection limit (second request ends early):

```powershell
# Terminal 1 (holds the only allowed connection ~20s)
Invoke-WebRequest -Uri http://127.0.0.1:5000/info | Select-Object -ExpandProperty Content

# Quickly in Terminal 2 (while first still running)
Invoke-WebRequest -Uri http://127.0.0.1:5000/info
```

Expected:

- First call returns JSON after ~20 seconds.
- Second call fails fast with an error similar to:

```text
Invoke-WebRequest: The response ended prematurely. (ResponseEnded)
```

(Exact wording may vary.) This demonstrates throttling via `-MaxConcurrentConnections 1`.

## Cmdlet references

- [Set-KrServerLimit][Set-KrServerLimit]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [Start-KrServer][Start-KrServer]

## Troubleshooting

| Symptom                | Cause                               | Fix                              |
| ---------------------- | ----------------------------------- | -------------------------------- |
| Large upload rejected  | Limit too small                     | Increase `MaxRequestBodySize`    |
| Clients disconnect     | Data rate limits strict             | Relax Min\*DataRate values       |
| Slow responses         | Too few connections                 | Raise `MaxConcurrentConnections` |
| Second request aborted | `MaxConcurrentConnections` set to 1 | Increase value or remove limit   |

See also: [Endpoints](../7.endpoints/index) · [Logging](../5.logging/index)

---

### Next

Continue to [Server Options](./2.Server-Options).

[13.1-Server-Limits.ps1]: /pwsh/tutorial/examples/13.1-Server-Limits.ps1
[Set-KrServerLimit]: /pwsh/cmdlets/Set-KrServerLimit
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
