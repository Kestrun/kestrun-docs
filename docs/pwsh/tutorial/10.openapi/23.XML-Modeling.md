---
title: XML Modeling
parent: OpenApi
nav_order: 23
layout: default
---

# XML Modeling

Demonstrate OpenAPI 3.2 XML modeling with attributes, namespaces, and wrapped arrays using the `OpenApiXml` attribute.

## Full source

File: [`pwsh/tutorial/examples/10.22-OpenAPI-XML-Modeling.ps1`][10.22-OpenAPI-XML-Modeling.ps1]

```powershell
{% include examples/pwsh/10.22-OpenAPI-XML-Modeling.ps1 %}
```

## Step-by-step

1. **Logging**: Register console logger as default.
2. **Server**: Create server named 'OpenAPI XML Modeling'.
3. **OpenAPI Info**: Add title, version, and description.
4. **Product Schema**: Define `Product` class with XML-specific attributes:
   - `Id`: XML attribute (not element) with custom name 'id'
   - `Name`: Custom element name 'ProductName'
   - `Price`: Custom namespace and prefix
   - `Items`: Wrapped array with custom item name
5. **GET Endpoint**: Return a product by ID with XML serialization.
6. **POST Endpoint**: Accept product payload and return created product.
7. **Build OpenAPI Document**: Build and validate the OpenAPI specification.
8. **Start Server**: Run the server with XML-enabled endpoints.

## Try it

```powershell
# Get product by ID (returns XML)
curl -H "Accept: application/xml" http://127.0.0.1:5000/products/5

# Get product by ID (returns JSON)
curl -H "Accept: application/json" http://127.0.0.1:5000/products/5

# Create a new product (POST with XML)
curl -X POST http://127.0.0.1:5000/products `
  -H "Content-Type: application/xml" `
  -d '<Product id="123">
    <ProductName>Widget</ProductName>
    <price:Price xmlns:price="http://example.com/pricing">19.99</price:Price>
    <Items>
      <Item>Item1</Item>
      <Item>Item2</Item>
    </Items>
  </Product>'

# Create a new product (POST with JSON)
curl -X POST http://127.0.0.1:5000/products `
  -H "Content-Type: application/json" `
  -d '{
    "Id": 123,
    "Name": "Widget",
    "Price": 19.99,
    "Items": ["Item1", "Item2", "Item3"]
  }'

# View the OpenAPI specification with XML metadata
curl http://127.0.0.1:5000/openapi/v3.1/openapi.json | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

PowerShell equivalent for POST:

```powershell
$body = @{
    Id = 123
    Name = 'Widget'
    Price = 19.99
    Items = @('Item1', 'Item2', 'Item3')
} | ConvertTo-Json

Invoke-WebRequest -Uri http://127.0.0.1:5000/products `
    -Method Post `
    -Headers @{ 'Content-Type' = 'application/json' } `
    -Body $body | Select-Object StatusCode, Content
```

## OpenApiXml Attribute

The `OpenApiXml` attribute provides XML-specific configuration for OpenAPI 3.2:

```powershell
[OpenApiSchemaComponent(Title = 'Product')]
class Product {
    # XML attribute (not element)
    [OpenApiXml(Name = 'id', Attribute = $true)]
    [int]$Id

    # Custom element name
    [OpenApiXml(Name = 'ProductName')]
    [string]$Name

    # Namespace and prefix
    [OpenApiXml(Name = 'Price', Namespace = 'http://example.com/pricing', Prefix = 'price')]
    [decimal]$Price

    # Wrapped array
    [OpenApiXml(Name = 'Item', Wrapped = $true)]
    [string[]]$Items
}
```

### Properties

- **Name**: Overrides the element/attribute name in XML
- **Attribute**: When `$true`, renders as XML attribute instead of element
- **Namespace**: XML namespace URI for the element
- **Prefix**: Namespace prefix for the element
- **Wrapped**: When `$true`, wraps array items in an enclosing element

## XML Output Example

With the attributes above, the Product schema generates XML like:

```xml
<Product id="123">
    <ProductName>Widget</ProductName>
    <price:Price xmlns:price="http://example.com/pricing">19.99</price:Price>
    <Items>
        <Item>Item1</Item>
        <Item>Item2</Item>
        <Item>Item3</Item>
    </Items>
</Product>
```

## Key Concepts

### XML Attributes vs Elements

By default, properties are serialized as XML elements. Use `Attribute = $true` to render as XML attributes:

```powershell
# Element (default)
[OpenApiXml(Name = 'ProductName')]
[string]$Name
# Generates: <ProductName>Widget</ProductName>

# Attribute
[OpenApiXml(Name = 'id', Attribute = $true)]
[int]$Id
# Generates: <Product id="123">
```

### Namespaces and Prefixes

Add XML namespaces to prevent naming conflicts:

```powershell
[OpenApiXml(Name = 'Price', Namespace = 'http://example.com/pricing', Prefix = 'price')]
[decimal]$Price
# Generates: <price:Price xmlns:price="http://example.com/pricing">19.99</price:Price>
```

### Array Wrapping

Control how arrays are serialized:

```powershell
# Unwrapped (default)
[string[]]$Items
# Generates: <Item>Item1</Item><Item>Item2</Item>

# Wrapped
[OpenApiXml(Name = 'Item', Wrapped = $true)]
[string[]]$Items
# Generates: <Items><Item>Item1</Item><Item>Item2</Item></Items>
```

## OpenAPI Schema Output

The XML metadata is included in the OpenAPI schema:

```json
{
  "components": {
    "schemas": {
      "Product": {
        "type": "object",
        "properties": {
          "Id": {
            "type": "integer",
            "xml": {
              "name": "id",
              "attribute": true
            }
          },
          "Name": {
            "type": "string",
            "xml": {
              "name": "ProductName"
            }
          },
          "Price": {
            "type": "number",
            "xml": {
              "name": "Price",
              "namespace": "http://example.com/pricing",
              "prefix": "price"
            }
          },
          "Items": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "xml": {
              "name": "Item",
              "wrapped": true
            }
          }
        }
      }
    }
  }
}
```

## Troubleshooting

| Symptom | Cause | Fix |
|--------|-------|-----|
| XML binds but properties are empty | XML element/attribute names don't match the `OpenApiXml` mapping | Update `OpenApiXml(Name = '...')` to match the payload, or update the payload to match the modeled names. |
| Server returns `415 Unsupported Media Type` | Missing or incorrect `Content-Type` header | Send `Content-Type: application/xml` for XML request bodies. |
| Namespaced elements don't serialize with expected prefix | Namespace URI/prefix not declared | Ensure `OpenApiXml(Namespace=..., Prefix=...)` is set and the XML payload declares `xmlns:prefix="..."`. |
| Error like `Cannot convert the "Product" value of type "Product" to type "Product"` | PowerShell script-defined classes are **runspace-scoped**; when an object instance originates from a different runspace, PowerShell can treat it as a different type even if the name matches | Prefer letting Kestrun map XML into a plain hashtable/object and let PowerShell bind in the active request runspace. If you still hit this, use `[object]` for the body and cast/convert inside the route, or define the model class in a module that is imported into all request runspaces. |

## References

- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Build-KrOpenApiDocument][Build-KrOpenApiDocument]
- [Test-KrOpenApiDocument][Test-KrOpenApiDocument]
- [Write-KrResponse][Write-KrResponse]
- [OpenApiPath][OpenApiPath]
- [OpenApiResponse][OpenApiResponse]
- [OpenApiRequestBody][OpenApiRequestBody]
- [Start-KrServer][Start-KrServer]
- [OpenAPI 3.2 XML Object Specification][OpenAPI 3.2 XML Object Specification]
- [W3C XML Namespaces][W3C XML Namespaces]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [SignalR (OpenAPI)](./22.SignalR)
Next: [RFC 6570 Variable Mapping](./24.RFC6570-Variable-Mapping)

[10.22-OpenAPI-XML-Modeling.ps1]: /pwsh/tutorial/examples/10.22-OpenAPI-XML-Modeling.ps1
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Build-KrOpenApiDocument]: /pwsh/cmdlets/Build-KrOpenApiDocument
[Test-KrOpenApiDocument]: /pwsh/cmdlets/Test-KrOpenApiDocument
[Write-KrResponse]: /pwsh/cmdlets/Write-KrResponse
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[OpenApiRequestBody]: /pwsh/cmdlets/OpenApiRequestBody
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[OpenAPI 3.2 XML Object Specification]: https://spec.openapis.org/oas/v3.2.0#xml-object
[W3C XML Namespaces]: https://www.w3.org/TR/xml-names/
