---
title: Component Schemas
parent: OpenApi
nav_order: 2
---

# Component Schemas

Define reusable request and response schemas using PowerShell classes decorated with OpenAPI attributes.

## Full source

File: [`pwsh/tutorial/examples/10.2-OpenAPI-Component-Schema.ps1`][10.2-OpenAPI-Component-Schema.ps1]

```powershell
{% include examples/pwsh/10.2-OpenAPI-Component-Schema.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server named 'OpenAPI Component Schema'.
3. OpenAPI info: Add title, version, and description.
4. Define `CreateUserRequest` schema with required fields (firstName, lastName, email).
5. Define `UserResponse` schema with all user fields including timestamps.
6. POST endpoint: Accept `CreateUserRequest` body (JSON/XML/YAML/form) and return `UserResponse` (201) or 400.
7. GET endpoint: Return `UserResponse` (200) for a given user ID or 404 when missing.
8. Build and test OpenAPI document, then start server.

## Try it

```powershell
# Create a new user (POST with CreateUserRequest)
curl -X POST http://127.0.0.1:5000/users `
  -H "Content-Type: application/json" `
  -d '{
    "firstName": "Jane",
    "lastName": "Smith",
    "email": "jane.smith@example.com",
    "age": 28
  }'

# Get user by ID (returns UserResponse)
curl -i http://127.0.0.1:5000/users/1

# View the OpenAPI specification
curl http://127.0.0.1:5000/openapi/v1/openapi.json | ConvertFrom-Json | ConvertTo-Json
```

PowerShell equivalent for POST:

```powershell
$body = @{
    firstName = 'Jane'
    lastName  = 'Smith'
    email     = 'jane.smith@example.com'
    age       = 28
} | ConvertTo-Json

Invoke-WebRequest -Uri http://127.0.0.1:5000/users `
    -Method Post `
    -Headers @{ 'Content-Type' = 'application/json' } `
    -Body $body | Select-Object StatusCode, Content
```

## Schema Component Attributes

```powershell
[OpenApiSchemaComponent(RequiredProperties = ('firstName', 'lastName', 'email'))]
class CreateUserRequest {
    [OpenApiPropertyAttribute(Description = 'First name', Example = 'John')]
    [string]$firstName
}
```

- **RequiredProperties**: Comma-separated field names that must be present.
- **Description**: Markdown-formatted component description.
- **OpenApiPropertyAttribute**: Decorates individual properties with constraints (Example, Format, MinLength, MaxLength, Pattern, etc.).

### PowerShell Enums as Reusable Components

PowerShell `enum` types are automatically registered as **reusable schema components** under `components.schemas` and referenced via `$ref`.

Example:

```powershell
enum TicketType {
    general
    event
}

[OpenApiSchemaComponent()]
class LineItem {
    [TicketType]$ticketType
    [int]$quantity
}
```

OpenAPI output:

```yaml
components:
  schemas:
    TicketType:
      type: string
      enum: [general, event]
    LineItem:
      type: object
      properties:
        ticketType:
          $ref: '#/components/schemas/TicketType'
        quantity:
          type: integer
```

**Benefits:**

- No duplication when reusing the same enum across multiple schemas
- Better code generation for API clients
- Cleaner, more maintainable OpenAPI documents

> **Note:** For one-off property constraints that won't be reused, use `[ValidateSet('value1', 'value2')]` instead of defining a PowerShell enum.

### Schema vendor extensions (`x-*`)

You can attach OpenAPI vendor extensions directly to a schema component class using the `[OpenApiExtension]` attribute.

> **Note:** Extension keys must start with `x-`. The value must be valid JSON (string/object/array/number/etc.).

Example:

```powershell
[OpenApiSchemaComponent(Description = 'Postal address.', RequiredProperties = ('street', 'city', 'postalCode'))]
[OpenApiExtension('x-badges', '[{"name":"Beta","position":"before","color":"purple"},{"name":"PII","position":"after","color":"orange"}]')]
[OpenApiExtension('x-kestrun-demo', '{"owner":"docs","stability":"beta","containsPii":true}')]
class Address {
  [string]$street
  [string]$city
  [string]$postalCode
}
```

In the generated OpenAPI document youâ€™ll find these on the schema under:

- `components.schemas.Address.x-badges`
- `components.schemas.Address.x-kestrun-demo`

## Key Concepts

- **Request Schema**: Defines the structure of incoming data (POST/PUT bodies).
- **Response Schema**: Defines the structure of outgoing data.
- **Multiple content types**: POST supports `application/json`, `application/xml`, `application/yaml`, and form data.
- **Reusability**: Schemas are registered as OpenAPI components and can be referenced across multiple endpoints.
- **Validation**: Use `RequiredProperties` on the class and `ValidateLength`, `ValidateRange`, `ValidateSet` on properties for constraints.
- **Examples**: Populate `Example` attribute for clear documentation.
- **Write-KrResponse content type**: Automatically chooses JSON/XML/YAML and supports `application/x-www-form-urlencoded`, respecting `[OpenApiResponse]` `ContentType`.

### Attribute decoration cheatsheet

- `[OpenApiPath]`: Declares the route/verb and wires the function into OpenAPI generation.
- `[OpenApiResponse]`: Documents each status code, description, schema, and content types.
- `[OpenApiRequestBody]`: Documents inline bodies (or use `Ref` variants to point to components).
- `[OpenApiSchemaComponent]` / `[OpenApiPropertyAttribute]`: Define reusable schemas and property metadata (description, format, examples, validation ranges/sets).

## Troubleshooting

**Issue**: Schema component not appearing in OpenAPI spec.

- **Solution**: Ensure the class has `[OpenApiSchemaComponent()]` attribute and is referenced in a request body or response.

**Issue**: Required fields validation not working.

- **Solution**: Add `RequiredProperties = ('field1', 'field2')` parameter to `[OpenApiSchemaComponent()]` attribute.

**Issue**: Write-KrResponse returns wrong content type.

- **Solution**: Verify Accept header in request matches one of the `ContentType` values in `[OpenApiResponse]` attribute.

## References

- [OpenApiSchemaComponent][OpenApiSchemaComponent]
- [OpenApiPropertyAttribute][OpenApiPropertyAttribute]
- [OpenApiRequestBody][OpenApiRequestBody]
- [OpenApiResponse][OpenApiResponse]
- [OpenApiPath][OpenApiPath]
- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Build-KrOpenApiDocument][Build-KrOpenApiDocument]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Hello World](./1.Hello-World)
Next: [RequestBody Components](./3.RequestBody-Components)

[OpenApiSchemaComponent]: /pwsh/cmdlets/OpenApiSchemaComponent
[OpenApiPropertyAttribute]: /pwsh/cmdlets/OpenApiPropertyAttribute
[OpenApiRequestBody]: /pwsh/cmdlets/OpenApiRequestBody
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Build-KrOpenApiDocument]: /pwsh/cmdlets/Build-KrOpenApiDocument
