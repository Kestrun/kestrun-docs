---
title: Redocly Museum API
parent: OpenApi
nav_order: 15
---

# Redocly Museum API

A comprehensive example implementing the [Redocly Museum API](https://redocly.com/docs/cli/) specification using Kestrun.

## Full source

File: [`pwsh/tutorial/examples/10.15-OpenAPI-Museum.ps1`][10.15-Museum.ps1]

```powershell
{% include examples/pwsh/10.15-OpenAPI-Museum.ps1 %}
```

## Step-by-step

1. **Logging**: Initialize console logger.
2. **Server**: Create 'Redocly Museum API' server.
3. **Info**: Configure API title, description, contact, and license.
4. **Tags**: Define tags for 'Operations', 'Events', and 'Tickets'.
5. **Schemas**: Define data models (`MuseumDailyHours`, `SpecialEvent`, etc.) using `[OpenApiSchemaComponent]`.
    - **Inheritance**: `GetMuseumHoursResponse` inherits from `MuseumDailyHours` but adds `Array = $true`.
    - **Validation**: `TicketType` uses `Enum` validation.
    - **Formats**: `TicketId` uses `Format = 'uuid'`.
    - **Reusable primitive components**: `Date : OpenApiString` defines a `string` with `format: date` once,
      then fields like `ticketDate` and `MuseumDailyHours.date` use `[Date]` so the OpenAPI uses `$ref`.
6. **Parameters**: Define reusable parameters using `[OpenApiParameterComponent]`, then reference them from routes using `[OpenApiParameterRef]`.
7. **Security**: Implement `MuseumPlaceholderAuth` (Basic Auth) using `Add-KrBasicAuthentication`.
8. **Routes**: Implement operations:
    - `listSpecialEvents` (GET): Uses query parameters for filtering.
    - `createSpecialEvent` (POST): Accepts `CreateSpecialEventRequest` body.
    - `buyMuseumTickets` (POST): Returns `BuyMuseumTicketsResponse` with generated ticket ID.
    - `getTicketCode` (GET): Returns binary image content (`image/png`).
9. **Documentation**: Enable OpenAPI route and build the document.

## Simple primitive schema components

The Museum example uses Kestrun's OpenAPI primitive wrapper types (like `OpenApiString`) to create reusable primitive schemas.

This pattern is useful when you want:

- A named schema under `components.schemas`.
- Other schemas to reference it via `$ref`.
- One place to set `format`/`example` for a primitive.

Example (`Date`):

```powershell
[OpenApiSchemaComponent(Format = 'date', Example = '2023-10-29')]
class Date : OpenApiString {}

[OpenApiSchemaComponent(RequiredProperties = ('ticketDate'))]
class BuyMuseumTicketsRequest {
  [OpenApiProperty(Description = 'Date that the ticket is valid for.')]
  [Date]$ticketDate
}
```

## Try it

Start the server and explore the API:

```powershell
# List special events
curl -i http://127.0.0.1:5000/special-events

# Buy a ticket
curl -i -X POST http://127.0.0.1:5000/tickets `
  -H "Content-Type: application/json" `
  -d '{"ticketType": "general", "ticketDate": "2023-12-01", "email": "visitor@example.com"}'

# Get ticket QR code (returns binary PNG data)
curl -i http://127.0.0.1:5000/tickets/a54a57ca-36f8-421b-a6b4-2e8f26858a4c/qr --output ticket.png
```

## Key Points

- **Complex Schemas**: Demonstrates inheritance (`GetMuseumHoursResponse:MuseumDailyHours`) and array types.
- **Parameter References**: Uses `[OpenApiParameterRefAttribute]` to link route parameters to component definitions.
- **Binary Responses**: The `getTicketCode` route demonstrates returning binary data (`image/png`) documented in OpenAPI.
- **Real-world Spec**: Based on the official Redocly example used for testing API tools.

## Troubleshooting

**Issue**: API returns 400 Bad Request when creating events.

- **Solution**: Verify all required fields are provided in the JSON payload. Check the OpenAPI spec at
    `/openapi/v1/openapi.json` for the exact field names and types.

**Issue**: Ticket code endpoint returns invalid PNG.

- **Solution**: In a production implementation, generate a real QR code image. The example uses placeholder bytes for demonstration.

## References

- [Redocly Museum API Example][Redocly Museum API Example]
- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrOpenApiTag][Add-KrOpenApiTag]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Swagger Petstore](./14.Petstore-API)
Next: [Multiple OpenAPI Documents](./18.Multi-Document-OpenAPI)

[10.15-Museum.ps1]: https://github.com/Kestrun/Kestrun/blob/main/docs/_includes/examples/pwsh/10.15-OpenAPI-Museum.ps1
[Redocly Museum API Example]: https://redocly.com/docs/cli/
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrOpenApiTag]: /pwsh/cmdlets/Add-KrOpenApiTag
