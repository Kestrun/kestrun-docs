---
title: SSE Broadcast (OpenAPI)
parent: OpenApi
nav_order: 21
layout: default
---

# SSE Broadcast (OpenAPI)

Document a broadcast SSE endpoint (`text/event-stream`) and a JSON broadcast trigger API using OpenAPI.

## Full source

File: [`pwsh/tutorial/examples/10.21-OpenAPI-SseBroadcast.ps1`][10.21-OpenAPI-SseBroadcast.ps1]

```powershell
{% include examples/pwsh/10.21-OpenAPI-SseBroadcast.ps1 %}
```

## Step-by-step

1. Logging: Register a console logger as default.
2. Server: Create a server and listener (IP + port).
3. OpenAPI: Add document metadata with `Add-KrOpenApiInfo`.
4. Schemas: Define request/response schema components for `/api/broadcast`.
5. SSE broadcast: Add `Add-KrSseBroadcastMiddleware` to keep `/sse/broadcast` connections open.
6. Configuration: Enable configuration and add Swagger/ReDoc routes.
7. Routes: Map `/` (HTML demo) and `InvokeSseBroadcast` (OpenAPI-annotated POST route).
8. Spec: Add the OpenAPI route, build + validate the document, then start the server.

## Try it

Start the server:

```powershell
pwsh .\docs\_includes\examples\pwsh\10.21-OpenAPI-SseBroadcast.ps1
```

Open the demo page and connect:

```powershell
Start-Process http://127.0.0.1:5000/
```

Broadcast a message via the API:

```powershell
curl -i -X POST http://127.0.0.1:5000/api/broadcast \
  -H "Content-Type: application/json" \
  -d "{\"event\":\"message\",\"data\":{\"text\":\"hello\"}}"
```

Fetch the OpenAPI document and open Swagger:

```powershell
curl http://127.0.0.1:5000/openapi/v3.1/openapi.json
Start-Process http://127.0.0.1:5000/swagger
```

## Troubleshooting

| Symptom | Cause | Fix |
|--------|-------|-----|
| `/sse/broadcast` missing from OpenAPI | SSE broadcast endpoint is mapped as middleware | Ensure you are running a Kestrun build where the broadcast SSE endpoint is registered in the host route registry for OpenAPI generation. |
| Broadcast returns 500 | Invalid JSON body | Ensure `Content-Type: application/json` and send `{ event, data }`. |
| Browser connects but shows no events | No broadcasts sent | Trigger a broadcast from `/api/broadcast` (or the demo UI buttons). |

## References

- [Add-KrSseBroadcastMiddleware][Add-KrSseBroadcastMiddleware]
- [Send-KrSseBroadcastEvent][Send-KrSseBroadcastEvent]
- [Get-KrSseConnectedClientCount][Get-KrSseConnectedClientCount]
- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Build-KrOpenApiDocument][Build-KrOpenApiDocument]
- [Test-KrOpenApiDocument][Test-KrOpenApiDocument]
- [OpenApiPath][OpenApiPath]
- [OpenApiRequestBody][OpenApiRequestBody]
- [OpenApiResponse][OpenApiResponse]
- [Start-KrServer][Start-KrServer]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [SSE (OpenAPI)](./20.Sse)
Next: [SignalR (OpenAPI)](./22.SignalR)

[10.21-OpenAPI-SseBroadcast.ps1]: /pwsh/tutorial/examples/10.21-OpenAPI-SseBroadcast.ps1
[Add-KrSseBroadcastMiddleware]: /pwsh/cmdlets/Add-KrSseBroadcastMiddleware
[Send-KrSseBroadcastEvent]: /pwsh/cmdlets/Send-KrSseBroadcastEvent
[Get-KrSseConnectedClientCount]: /pwsh/cmdlets/Get-KrSseConnectedClientCount
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrApiDocumentationRoute]: /pwsh/cmdlets/Add-KrApiDocumentationRoute
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Build-KrOpenApiDocument]: /pwsh/cmdlets/Build-KrOpenApiDocument
[Test-KrOpenApiDocument]: /pwsh/cmdlets/Test-KrOpenApiDocument
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[OpenApiRequestBody]: /pwsh/cmdlets/OpenApiRequestBody
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
