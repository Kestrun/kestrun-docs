---
title: RequestBody Components
parent: OpenApi
nav_order: 3
---

# RequestBody Components

Create reusable request body components that can be shared across multiple endpoints.

## Full source

File: [`pwsh/tutorial/examples/10.3-OpenAPI-Component-RequestBody.ps1`][10.3-OpenAPI-Component-RequestBody.ps1]

```powershell
{% include examples/pwsh/10.3-OpenAPI-Component-RequestBody.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server named 'OpenAPI RequestBody Component'.
3. OpenAPI info: Add title and description.
4. Define `Product` schema (id, productName, price, description, stock, createdAt).
5. Create `CreateProductRequest` component wrapping `Product` (JSON + form data) via `OpenApiRequestBodyComponent`.
6. Create `UpdateProductRequest` component (JSON) with required name/price via `OpenApiRequestBodyComponent`.
7. POST endpoint: Accept `CreateProductRequest` (via `OpenApiRequestBodyRef`) and return `Product` (201) or 400.
8. PUT endpoint: Accept `UpdateProductRequest` (via `OpenApiRequestBodyRef`) and return updated `Product` (200) or 400/404.
9. Build and test OpenAPI document.

## Try it

```powershell
# Create product using CreateProductRequest component
curl -X POST http://127.0.0.1:5000/products `
  -H "Content-Type: application/json" `
  -d '{
    "productName": "Gaming Laptop",
    "price": 1599.99,
    "description": "High-performance laptop for gaming",
    "stock": 25
  }'

# Update product using UpdateProductRequest component
curl -X PUT http://127.0.0.1:5000/products/1 `
  -H "Content-Type: application/json" `
  -d '{
    "productName": "Gaming Laptop Pro",
    "price": 1899.99,
    "stock": 15
  }'

# View request body components in OpenAPI spec
curl http://127.0.0.1:5000/openapi/v1/openapi.json | jq '.components.requestBodies'
```

PowerShell create example:

```powershell
$createPayload = @{
    productName = 'Gaming Laptop'
    price       = 1599.99
    description = 'High-performance laptop for gaming'
    stock       = 25
} | ConvertTo-Json

Invoke-WebRequest -Uri http://127.0.0.1:5000/products `
    -Method Post `
    -Headers @{ 'Content-Type' = 'application/json' } `
    -Body $createPayload
```

## RequestBody Component Attributes

```powershell
[OpenApiRequestBodyComponent(
    Description = 'Product creation payload',
    Required = $true,
    ContentType = ('application/json', 'application/x-www-form-urlencoded')
)]
[Product]$CreateProductRequest
```

- **Description**: Human-readable description of the request body.
- **Required**: Set to `$true` to mark the request body as required.
- **ContentType**: Single or array of supported MIME types (e.g., `'application/json'`, `'application/xml'`).
- **Type**: The variable type becomes the request body schema (typically a schema component type).

## Key Concepts

- **Reusability**: Define once, reference with `OpenApiRequestBodyRef` in multiple endpoints.
- **Multiple Content Types**: Create supports JSON and form; update uses JSON.
- **Schema Inheritance**: Use PowerShell class inheritance for schemas when needed (request bodies reference those schema types).
- **Typed responses**: POST/PUT return the `Product` schema with server-generated fields (`id`, `createdAt`).
- **Write-KrResponse content type**: Automatically chooses JSON/XML and respects `[OpenApiResponse]` `ContentType` when serializing responses.
- **Separation**: Distinct request components for different operations (Create vs. Update).

### Attribute decoration cheatsheet

- `[OpenApiPath]`: Declares verb + route; drives OpenAPI operation generation.
- `[OpenApiResponse]`: Documents status codes, descriptions, schemas, and content types.
- `[OpenApiRequestBodyRef]` / `[OpenApiRequestBody]`: Reuse component bodies or document inline payloads.
- `[OpenApiSchemaComponent]` / `[OpenApiPropertyAttribute]`: Define reusable schemas and property constraints (description, format, examples, validation).

## Troubleshooting

**Issue**: Request body component not referenced correctly.

- **Solution**: Ensure `[OpenApiRequestBodyRef(ReferenceId = '...')]` matches the request-body component name (the annotated variable name,
or the `Key` override on `[OpenApiRequestBodyComponent]`).

**Issue**: Class inheritance not working with request body components.

- **Solution**: Use colon syntax `class CreateRequest:BaseSchema {}` to inherit properties from base schema.

**Issue**: Multiple content types not being accepted.

- **Solution**: Specify all content types in `ContentType` parameter: `ContentType = ('application/json', 'application/xml')`.

## References

- [OpenApiRequestBodyComponent][OpenApiRequestBodyComponent]
- [OpenApiRequestBodyRef][OpenApiRequestBodyRef]
- [OpenApiResponse][OpenApiResponse]
- [OpenApiPath][OpenApiPath]
- [Build-KrOpenApiDocument][Build-KrOpenApiDocument]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Component Schemas](./2.Component-Schemas.md)
Next: [Parameter Components](./4.Parameter-Components.md)

[OpenApiRequestBodyComponent]: /pwsh/cmdlets/OpenApiRequestBodyComponent
[OpenApiRequestBodyRef]: /pwsh/cmdlets/OpenApiRequestBodyRef
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[Build-KrOpenApiDocument]: /pwsh/cmdlets/Build-KrOpenApiDocument
