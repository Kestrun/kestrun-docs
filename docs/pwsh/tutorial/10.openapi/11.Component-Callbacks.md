---
title: Component Callbacks
parent: OpenAPI Generation
nav_order: 51
---

# Component Callbacks

Demonstrates how to define reusable callback components for asynchronous operations.

This example models a realistic **payment creation** flow where the client provides callback URLs, and the API documents the callback requests it may send.

## Full source

File: [`pwsh/tutorial/examples/10.11-OpenAPI-Component-Callback.ps1`][10.11-OpenAPI-Component-Callback.ps1]

```powershell
{% include examples/pwsh/10.11-OpenAPI-Component-Callback.ps1 %}
```

## Step-by-step

1. **Define callback payload schemas** using `[OpenApiSchemaComponent]` so they appear under `components.schemas`.
2. **Declare callback operations** with `[OpenApiCallback]`:

    - Use `Expression = '$request.body#/callbackUrls/<name>'` to reference a client-provided callback URL.
    - Use `HttpVerb` + `Pattern` for the callback request your API will send.

3. **Attach callbacks to the main operation** with `[OpenApiCallbackRef]` on the primary route (here: `POST /v1/payments`).
4. **Rely on comment-based help** (`<# .SYNOPSIS/.DESCRIPTION/.PARAMETER #>`) to populate OpenAPI `summary`/`description`.
5. **Enable callback automation** with `Add-KrAddCallbacksAutomation` if you want those callback functions to actually dispatch HTTP callback requests at runtime
(not just appear in OpenAPI).

## Try it

Run the example script and inspect the generated OpenAPI:

```powershell
# From the repo root
Import-Module ./src/PowerShell/Kestrun/Kestrun.psd1 -Force

./docs/_includes/examples/pwsh/10.11-OpenAPI-Component-Callback.ps1 -Port 5000
```

Then visit:

- OpenAPI JSON: `http://127.0.0.1:5000/openapi/v3.1/openapi.json`
- Swagger UI: `http://127.0.0.1:5000/swagger`
- ReDoc: `http://127.0.0.1:5000/redoc`

Try the main operation:

```powershell
$body = @{
  amount = 129.99
  currency = 'USD'
  callbackUrls = @{
    # For this tutorial, point callbacks back at the same local server.
    # The callback middleware will append the callback pattern (e.g. /v1/payments/{paymentId}/status)
    # to these base URLs.
    status = 'http://127.0.0.1:5000/callbacks/payment-status'
    reservation = 'http://127.0.0.1:5000/callbacks/reservation'
    shippingOrder = 'http://127.0.0.1:5000/callbacks/shipping-order'
  }
} | ConvertTo-Json -Depth 10

Invoke-RestMethod -Uri 'http://127.0.0.1:5000/v1/payments' -Method Post -ContentType 'application/json' -Body $body
```

In the OpenAPI document, callbacks appear under:

- `paths['/v1/payments'].post.callbacks`

Referenced callback components appear under:

- `components.callbacks`

## Troubleshooting

### `summary` / `description` are missing in OpenAPI

- Ensure you used standard comment-based help blocks: `<# ... #>` (not `<#+ ... #>`).

### Callback schemas are missing from `components.schemas`

- Ensure the PowerShell classes are decorated with `[OpenApiSchemaComponent]`.

### Request body is not bound (400 / missing properties)

- Ensure `[OpenApiRequestBody(...)]` is applied to the *body parameter* of the function.

## References

- [OpenAPI Callback Object][OpenAPI Callback Object]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Component Links](./10.Component-Links.md)
Next: [WebHooks](./12.WebHooks.md)

[10.11-OpenAPI-Component-Callback.ps1]: https://github.com/Kestrun/Kestrun/blob/main/docs/_includes/examples/pwsh/10.11-OpenAPI-Component-Callback.ps1
[OpenAPI Callback Object]: https://spec.openapis.org/oas/v3.1.0#callback-object
