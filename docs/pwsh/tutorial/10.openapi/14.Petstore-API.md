---
title: Swagger Petstore
parent: OpenApi
nav_order: 14
---

# Swagger Petstore

Implementation of the classic [Swagger Petstore](https://github.com/swagger-api/swagger-petstore) example (OpenAPI 3.1) using Kestrun.

## Full source

File: [`pwsh/tutorial/examples/10.14-OpenAPI-PetStore.ps1`][10.14-PetStore.ps1]

```powershell
{% include examples/pwsh/10.14-OpenAPI-PetStore.ps1 %}
```

## Step-by-step

1. **Logging**: Initialize console logger.
2. **Server**: Create 'Swagger Petstore' server.
3. **Info**: Configure metadata matching the official Petstore spec, including description and terms of service.
4. **Security**:
    - **OAuth2**: Configure `petstore_auth` with implicit flow using `Add-KrOAuth2Authentication`.
    - **API Key**: Configure `api_key` header authentication using `Add-KrApiKeyAuthentication`.
5. **Schemas**: Define complex models:
    - `Pet`: Includes required fields and array of `photoUrls`.
    - `Order`: Includes enum for `status` (placed, approved, delivered).
    - `User`: Standard user profile model.
6. **Routes**: Implement core Petstore operations:
    - `addPet` (POST): Accepts `Pet` body, requires `petstore_auth` (write:pets).
    - `updatePet` (PUT): Updates existing pet, requires validation.
    - `findPetsByStatus` (GET): Uses `[ValidateSet]` for status parameter (available, pending, sold).
    - `getPetById` (GET): Retrieves pet by ID.
    - `uploadFile` (POST): Demonstrates file upload handling (octet-stream).
7. **Viewers**: Register multiple documentation viewers to compare rendering:
    - Swagger UI (`/swagger`)
    - Redoc (`/redoc`)
    - Scalar (`/scalar`)
    - Rapidoc (`/rapidoc`)
    - Elements (`/elements`)

## Try it

Start the server and view the documentation UI:

```powershell
# Open Swagger UI
Start-Process "http://127.0.0.1:5000/swagger"

# Find pets by status
curl -i "http://127.0.0.1:5000/pet/findByStatus?status=available"

# Add a new pet (requires auth simulation in this example)
curl -i -X POST http://127.0.0.1:5000/pet `
  -H "Content-Type: application/json" `
  -d '{"name": "Doggie", "photoUrls": ["url1"], "status": "available"}'
```

## Key Points

- **Security Schemes**: Demonstrates OAuth2 and API Key integration with `[OpenApiAuthorization]` attribute on routes.
- **Multiple Viewers**: Shows how to host Swagger UI, Redoc, and others simultaneously to provide different documentation experiences.
- **Validation**: Uses `[ValidateSet]` and OpenAPI constraints on parameters to enforce API contracts.
- **Polymorphism**: (Future) Will demonstrate `oneOf` / `anyOf` support when implemented.

## Troubleshooting

**Issue**: OAuth2 login flow is not working in Swagger UI.

- **Solution**: This example uses simplified OAuth2 configuration. In production, configure a real OAuth2 server endpoint
  with proper token validation.

**Issue**: API Key authentication is not enforced.

- **Solution**: The example includes the auth scheme definition but does not validate requests. Implement validation
  in route handlers or use middleware as needed.

## References

- [Swagger Petstore Repository][Swagger Petstore Repository]
- [Add-KrOAuth2Authentication][Add-KrOAuth2Authentication]
- [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Examples](./13.Examples.md)
Next: [Redocly Museum API](./15.Museum-API.md)

[10.14-PetStore.ps1]: https://github.com/Kestrun/Kestrun/blob/main/docs/_includes/examples/pwsh/10.14-OpenAPI-PetStore.ps1
[Swagger Petstore Repository]: https://github.com/swagger-api/swagger-petstore
[Add-KrOAuth2Authentication]: /pwsh/cmdlets/Add-KrOAuth2Authentication
[Add-KrApiDocumentationRoute]: /pwsh/cmdlets/Add-KrApiDocumentationRoute
