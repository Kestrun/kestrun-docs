---
title: SSE (OpenAPI)
parent: OpenApi
nav_order: 20
layout: default
---

# SSE (OpenAPI)

Document a Server-Sent Events (SSE) endpoint (`text/event-stream`) using OpenAPI.

## Full source

File: [`pwsh/tutorial/examples/10.20-OpenAPI-Sse.ps1`][10.20-OpenAPI-Sse.ps1]

```powershell
{% include examples/pwsh/10.20-OpenAPI-Sse.ps1 %}
```

## Step-by-step

1. Logging: Register a console logger as default.
2. Server: Create a server and listener (IP + port).
3. OpenAPI: Add document metadata with `Add-KrOpenApiInfo`.
4. Parameters: Define reusable query parameter components (`count`, `intervalMs`).
5. Configuration: Enable configuration and add Swagger/ReDoc routes.
6. UI: Map `/` with a browser `EventSource` client for `/sse`.
7. SSE route: Implement `GetSseStream` with OpenAPI attributes and SSE helpers.
8. Spec: Add the OpenAPI route, build + validate the document, then start the server.

## Try it

Start the server:

```powershell
pwsh .\docs\_includes\examples\pwsh\10.20-OpenAPI-Sse.ps1
```

Stream a short SSE response (closes after `count` events):

```powershell
curl -N "http://127.0.0.1:5000/sse?count=3&intervalMs=100"
```

Fetch the OpenAPI document and open Swagger:

```powershell
curl http://127.0.0.1:5000/openapi/v3.1/openapi.json
Start-Process http://127.0.0.1:5000/swagger
```

## Troubleshooting

| Symptom | Cause | Fix |
|--------|-------|-----|
| `/sse` missing from OpenAPI | Route not discovered | Ensure `Enable-KrConfiguration` is called and the route has OpenAPI attributes (`[OpenApiPath]`, `[OpenApiResponse]`). |
| Swagger loads but no operations appear | OpenAPI route not mapped | Add `Add-KrOpenApiRoute` before starting the server. |
| Browser reconnects repeatedly | Stream closes (expected) | This sample intentionally ends the stream after `count` events; handle `onerror` by closing the `EventSource`. |

## References

- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Build-KrOpenApiDocument][Build-KrOpenApiDocument]
- [Test-KrOpenApiDocument][Test-KrOpenApiDocument]
- [OpenApiParameterComponent][OpenApiParameterComponent]
- [OpenApiParameterRef][OpenApiParameterRef]
- [OpenApiPath][OpenApiPath]
- [OpenApiResponse][OpenApiResponse]
- [Start-KrSseResponse][Start-KrSseResponse]
- [Write-KrSseEvent][Write-KrSseEvent]
- [Start-KrServer][Start-KrServer]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Product Search with HTTP QUERY](./19.Product-Search-Query)
Next: [SSE Broadcast (OpenAPI)](./21.Sse-Broadcast)

[10.20-OpenAPI-Sse.ps1]: /pwsh/tutorial/examples/10.20-OpenAPI-Sse.ps1
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrApiDocumentationRoute]: /pwsh/cmdlets/Add-KrApiDocumentationRoute
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Build-KrOpenApiDocument]: /pwsh/cmdlets/Build-KrOpenApiDocument
[Test-KrOpenApiDocument]: /pwsh/cmdlets/Test-KrOpenApiDocument
[OpenApiParameterComponent]: /pwsh/cmdlets/OpenApiParameterComponent
[OpenApiParameterRef]: /pwsh/cmdlets/OpenApiParameterRef
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[Start-KrSseResponse]: /pwsh/cmdlets/Start-KrSseResponse
[Write-KrSseEvent]: /pwsh/cmdlets/Write-KrSseEvent
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
