---
title: Parameter Components
parent: OpenApi
nav_order: 4
---

# Parameter Components

Create reusable parameter components for query strings, path variables, headers, and cookies.

## Full source

File: [`pwsh/tutorial/examples/10.4-OpenAPI-Component-Parameter.ps1`][10.4-OpenAPI-Component-Parameter.ps1]

```powershell
{% include examples/pwsh/10.4-OpenAPI-Component-Parameter.ps1 %}
```

## Step-by-step

1. **Logging**: Register console logger as default.
2. **Server**: Create server named 'OpenAPI Parameter Component' and add endpoint.
3. **OpenAPI info**: Add title and description.
4. **Schema components**: Define reusable models like `CreateProductRequest`, `ProductItem`, `ProductListResponse`, `ErrorResponse`.
5. **Parameter components**: Define reusable Query/Path/Header/Cookie parameter components using `[OpenApiParameterComponent]`.
6. **Configuration**: Enable configuration and add Swagger/Redoc documentation routes.
7. **GET /v1/products**: List endpoint (filter/sort/paginate) referencing parameter components via `[OpenApiParameterRef]`.
8. **GET /v1/products/{productId}**: Path parameter component for `productId` and 404 response schema.
9. **POST /v1/products**: Request body schema + request-body example, plus a `dryRun` query parameter component.
10. **GET /v1/categories**: Extra route to show reusing parameter components across multiple paths.

## Try it

```powershell
# List products with pagination + filters
curl -i "http://127.0.0.1:5000/v1/products?page=1&limit=3&category=electronics&sortBy=price"

# Get a product by id
curl -i "http://127.0.0.1:5000/v1/products/1"

# Create a product (JSON body)
$body = @{
    name = 'USB-C Dock'
    category = 'electronics'
    price = 159.99
    tags = @('usb-c','dock')
} | ConvertTo-Json

curl -i "http://127.0.0.1:5000/v1/products" -Method Post -ContentType 'application/json' -Body $body

# Create product in dry-run mode (validate only)
curl -i "http://127.0.0.1:5000/v1/products?dryRun=true" -Method Post -ContentType 'application/json' -Body $body

# List categories
curl -i "http://127.0.0.1:5000/v1/categories?includeCounts=true"
```

PowerShell with parameter hashtable:

```powershell
$params = @{
    page    = 1
    limit   = 10
    sortBy  = 'price'
    category = 'electronics'
}

$uri = "http://127.0.0.1:5000/v1/products?" + ($params.GetEnumerator() | ForEach-Object { "$($_.Key)=$($_.Value)" } -join '&')

Invoke-WebRequest -Uri $uri | Select-Object StatusCode, Content
```

## Parameter Component Attributes

```powershell
# Component parameter definitions are registered once (outside the route function)

# Important: component variables must have an explicit value.
# - Assign a real value (e.g. `= 20`) to emit an OpenAPI `schema.default`.
# - Use `= NoDefault` to emit *no* OpenAPI default.
# - Avoid using `= $null` as a “no default” marker; `$null` is still a value.

[OpenApiParameterComponent(In = [OaParameterLocation]::Query, Description = 'Page number', Minimum = 1, Example = 1)]
[int]$page = 1

[OpenApiParameterComponent(In = [OaParameterLocation]::Query, Description = 'Items per page', Minimum = 1, Maximum = 100, Example = 20)]
[int]$limit = 20

[OpenApiParameterComponent(In = [OaParameterLocation]::Query, Description = 'Sort field (name, date, price)', Example = 'date')]
[ValidateSet('name', 'date', 'price')]
[string]$sortBy = 'date'

# Range constraints via PowerShell validation attributes
[OpenApiParameterComponent(In = [OaParameterLocation]::Query, Description = 'Items per page', Example = 20)]
[ValidateRange(1, 100)]
[int]$limit = 20

# (Optional) Header component example using a typed schema and an example reference
New-KrOpenApiExample -Summary 'Product Item Example' -Value ([ordered]@{ id = 1; name = 'Laptop'; category = 'electronics'; price = 999.99 }) |
    Add-KrOpenApiComponent -Name 'ProductItemExample'

[OpenApiParameterComponent(In = 'header', Description = 'Product item in header', ContentType = 'application/json', Required = $true)]
[OpenApiParameterExampleRefAttribute(ReferenceId = 'ProductItemExample', Key = 'application/json')]
[ProductItem]$productItems = NoDefault
```

**Attribute Pattern:**

- **`[OpenApiParameterComponent(...)]`**: Declares a reusable parameter component directly on a PowerShell variable/parameter.
- **`In = ...`**: Defines parameter location (Query, Path, Header, Cookie). You can use strings like `'Query'`/`'header'` or `[OaParameterLocation]::Query`.
- **`Minimum` / `Maximum` / `Example` / `ContentType` / `Required`**: Common metadata for generated OpenAPI.
- **PowerShell validation attributes** (recommended):
  - **`[ValidateSet(...)]`** → OpenAPI `schema.enum`
  - **`[ValidateRange(min,max)]`** → OpenAPI `schema.minimum`/`schema.maximum`
  - **`[ValidatePattern('...')]`** → OpenAPI `schema.pattern`
  - **`[ValidateLength(min,max)]`** → OpenAPI `schema.minLength`/`schema.maxLength`

**Usage in Functions:**

```powershell
function listProducts {
    param(
        [OpenApiParameterRef(ReferenceId = 'page')]
        [int]$page = 1,

        [OpenApiParameterRef(ReferenceId = 'limit')]
        [int]$limit = 20
    )
}
```

## Vendor Extensions (x-*)

You can attach OpenAPI vendor extensions to **parameter components** using `[OpenApiExtension]`.

- Keys must start with `x-`.
- In the OpenAPI JSON, extensions appear under `components.parameters.<name>.x-*`.

In this tutorial, the `correlationId` and `myCategory` parameter components include an `x-kestrun-demo` extension.

## Parameter Locations

Parameters can be in different locations:

- **Query**: `?page=1&limit=10` (most common for filtering/pagination).
- **Path**: `/v1/products/{productId}` (dynamic route segments).
- **Header**: Custom HTTP headers.
- **Cookie**: Cookie values.

## Key Concepts

- **Parameter Components**: Define reusable query, path, header, or cookie parameters once, reference with `[OpenApiParameterRef(ReferenceId = 'paramName')]`.
- **Component-first**: Declare components once, then keep route parameters clean with `[OpenApiParameterRef]`.
- **Schema Components**: Use `[OpenApiSchemaComponent()]` classes to define response structures (ProductItem, ProductListResponse).
- **Typed Responses**: Convert hashtables to typed PowerShell class instances for accurate OpenAPI schema documentation.
- **Content Negotiation**: `Write-KrResponse` automatically handles JSON, XML, YAML, and form-urlencoded based on Accept header.
- **Pagination**: Use `page` and `limit` parameters for result limiting and offset.
- **Filtering**: Combine filter parameters to narrow results (category, price range, date range).
- **Sorting**: Allow clients to specify sort order via `sortBy` parameter.
- **Validation**: Use constraints (Minimum, Maximum, Format) to document and validate parameter values.

## Attribute Decoration Cheatsheet

| Purpose | Attribute | Usage |
|---------|-----------|-------|
| Parameter component definition | `[OpenApiParameterComponent(In = ...)]` | Declares a reusable parameter component on a variable/parameter |
| Parameter reference | `[OpenApiParameterRef(ReferenceId = 'name')]` | References parameter component in function params |
| Schema component class | `[OpenApiSchemaComponent()]` | Marks class as reusable schema definition |
| Property schema | `[OpenApiPropertyAttribute(...)]` | Defines property constraints (Minimum, Maximum, Format, Example) |
| Route definition | `[OpenApiPath(HttpVerb = 'get', Pattern = '/path')]` | Maps function to HTTP endpoint |
| Response schema | `[OpenApiResponse(StatusCode = '200', Schema = [ClassName])]` | Documents response status and schema |

## Troubleshooting

**Issue**: Parameter reference not found in OpenAPI spec.

- **Solution**: Ensure `[OpenApiParameterRef(ReferenceId = '...')]` matches the *component name* (typically the variable/parameter name you decorated with `[OpenApiParameterComponent]`).

**Issue**: Script fails with “Unable to find type” for a typed parameter component.

- **Solution**: Ensure the referenced PowerShell class (e.g. `[ProductItem]`) is defined before you declare a component parameter using that type.

**Issue**: Query parameters not being parsed correctly.

- **Solution**: Verify `In = [OaParameterLocation]::Query` (or `In = 'Query'`) is set on each `[OpenApiParameterComponent]` definition for query parameters.

**Issue**: Validation constraints not appearing in OpenAPI.

- **Solution**: Put validation on the *component variable/parameter* using PowerShell attributes like `[ValidateSet]`, `[ValidateRange]`, `[ValidatePattern]`,
or set constraints directly on `[OpenApiParameterComponent(...)]` (e.g., `Minimum`, `Maximum`, `Pattern`, etc.).

## References

- [OpenApiParameterComponent][OpenApiParameterComponent]
- [OpenApiParameter][OpenApiParameter]
- [OpenApiParameterRef][OpenApiParameterRef]
- [OpenApiPropertyAttribute][OpenApiPropertyAttribute]
- [OpenApiSchemaComponent][OpenApiSchemaComponent]
- [OpenApiPath][OpenApiPath]
- [OpenApiResponse][OpenApiResponse]
- [Write-KrResponse][Write-KrResponse]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [RequestBody Components](./3.RequestBody-Components)
Next: [Response Components](./5.Response-Components)

[OpenApiParameterComponent]: /pwsh/cmdlets/OpenApiParameterComponent
[OpenApiParameter]: /pwsh/cmdlets/OpenApiParameter
[OpenApiParameterRef]: /pwsh/cmdlets/OpenApiParameterRef
[OpenApiPropertyAttribute]: /pwsh/cmdlets/OpenApiPropertyAttribute
[OpenApiSchemaComponent]: /pwsh/cmdlets/OpenApiSchemaComponent
[OpenApiPath]: /pwsh/cmdlets/OpenApiPath
[OpenApiResponse]: /pwsh/cmdlets/OpenApiResponse
[Write-KrResponse]: /pwsh/cmdlets/Write-KrResponse
