---
title: Multiple OpenAPI Documents
parent: OpenApi
nav_order: 18
layout: default
---

# Multiple OpenAPI Documents

Shows how to serve multiple OpenAPI documents (a default document plus a separate webhook document) from the same Kestrun server.

## Full source

File: [`pwsh/tutorial/examples/10.18-OpenAPI-MultiDocs.ps1`][10.18-OpenAPI-MultiDocs.ps1]

```powershell
{% include examples/pwsh/10.18-OpenAPI-MultiDocs.ps1 %}
```

## Step-by-step

1. **Logging**: Configure a console logger and set the minimum level.
2. **Server**: Create a server instance with [New-KrServer][New-KrServer] and add a listening endpoint using [Add-KrEndpoint][Add-KrEndpoint].
3. **Default OpenAPI doc metadata**: Set `info.title`, `info.version`, and description using [Add-KrOpenApiInfo][Add-KrOpenApiInfo].
4. **Second OpenAPI doc metadata**: Call [Add-KrOpenApiInfo][Add-KrOpenApiInfo] again with `-DocId 'WebHookDoc'` to create a separate document descriptor.
5. **Shared metadata**: Add contact and server information using [Add-KrOpenApiContact][Add-KrOpenApiContact] and [Add-KrOpenApiServer][Add-KrOpenApiServer].
6. **Configuration**: Call [Enable-KrConfiguration][Enable-KrConfiguration] to commit staged configuration.
7. **Documentation UIs**: Register Swagger and ReDoc viewers using [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute].
8. **Webhook operation**: Define a webhook operation using the `[OpenApiWebhook]` attribute and set `DocumentId = 'WebHookDoc'` so it is only emitted into the
webhook document.
9. **Regular path operation**: Define a normal request/response operation using `[OpenApiPath]` and return a response with [Write-KrTextResponse][Write-KrTextResponse].
10. **Expose OpenAPI routes**:
    - Call [Add-KrOpenApiRoute][Add-KrOpenApiRoute] to expose the default document at `/openapi/{version}/openapi.{format}`.
    - Call [Add-KrOpenApiRoute][Add-KrOpenApiRoute] again with `-DocumentId 'WebHookDoc'` to expose the second document. When a non-default document id is used
    with the default pattern, Kestrun serves it at `/openapi/{documentId}/{version}/openapi.{format}`.
11. **Run**: Start the server using [Start-KrServer][Start-KrServer].

## Try it

Run the example from the repository root:

```powershell
Import-Module .\src\PowerShell\Kestrun\Kestrun.psd1 -Force
.\docs\_includes\examples\pwsh\10.18-OpenAPI-MultiDocs.ps1 -Port 5000
```

Fetch both OpenAPI documents (JSON) using curl:

```powershell
# Default document
curl -i http://127.0.0.1:5000/openapi/v3.1/openapi.json

# Webhook-only document (DocId = 'WebHookDoc')
curl -i http://127.0.0.1:5000/openapi/WebHookDoc/v3.1/openapi.json
```

Browse the documentation UIs:

- Swagger UI: `http://127.0.0.1:5000/swagger`
- ReDoc: `http://127.0.0.1:5000/redoc`

## Troubleshooting

- **404 from OpenAPI endpoints**: Ensure you include an OpenAPI spec version like `v3.1` in the URL (`/openapi/v3.1/openapi.json`).
- **Missing webhook operations in the default doc**: Confirm your webhook function uses `DocumentId = 'WebHookDoc'` so it is scoped to the webhook document.
- **Multiple docs but only one route**: You need one [Add-KrOpenApiRoute][Add-KrOpenApiRoute] call per document you want to expose.

## References

- [New-KrLogger][New-KrLogger]
- [Add-KrSinkConsole][Add-KrSinkConsole]
- [Set-KrLoggerLevel][Set-KrLoggerLevel]
- [Register-KrLogger][Register-KrLogger]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Add-KrOpenApiInfo][Add-KrOpenApiInfo]
- [Add-KrOpenApiContact][Add-KrOpenApiContact]
- [Add-KrOpenApiServer][Add-KrOpenApiServer]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrApiDocumentationRoute][Add-KrApiDocumentationRoute]
- [Write-KrTextResponse][Write-KrTextResponse]
- [Add-KrOpenApiRoute][Add-KrOpenApiRoute]
- [Start-KrServer][Start-KrServer]
- [OpenAPI-Guide][OpenAPI-Guide]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Redocly Museum API](./15.Museum-API.md)
Next: [Product Search with HTTP QUERY (OpenAPI 3.2)](./19.Product-Search-Query.md)

[10.18-OpenAPI-MultiDocs.ps1]: /pwsh/tutorial/examples/10.18-OpenAPI-MultiDocs.ps1
[New-KrLogger]: /pwsh/cmdlets/New-KrLogger
[Add-KrSinkConsole]: /pwsh/cmdlets/Add-KrSinkConsole
[Set-KrLoggerLevel]: /pwsh/cmdlets/Set-KrLoggerLevel
[Register-KrLogger]: /pwsh/cmdlets/Register-KrLogger
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Add-KrOpenApiInfo]: /pwsh/cmdlets/Add-KrOpenApiInfo
[Add-KrOpenApiContact]: /pwsh/cmdlets/Add-KrOpenApiContact
[Add-KrOpenApiServer]: /pwsh/cmdlets/Add-KrOpenApiServer
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrApiDocumentationRoute]: /pwsh/cmdlets/Add-KrApiDocumentationRoute
[Write-KrTextResponse]: /pwsh/cmdlets/Write-KrTextResponse
[Add-KrOpenApiRoute]: /pwsh/cmdlets/Add-KrOpenApiRoute
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[OpenAPI-Guide]: /guides/openapi
