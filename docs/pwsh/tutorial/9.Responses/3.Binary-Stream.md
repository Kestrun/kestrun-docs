---
title: Binary & Stream
parent: Responses
nav_order: 3
---

# Binary & Stream Responses

Use these when returning non-text payloads, large files, or custom generated data.

## Full source

File: [`pwsh/tutorial/examples/9.3-Binary-Stream.ps1`][9.3-Binary-Stream.ps1]

```powershell
{% include examples/pwsh/9.3-Binary-Stream.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server named 'Responses 9.3'.
3. Listener: Listen on 127.0.0.1:5000.
4. Runtime: Add PowerShell runtime.
5. `/logo`: resolves file, reads all bytes, writes binary response.
6. `/stream`: opens text file stream, writes via streaming helper.
7. Error handling: returns error response if file missing.
8. Enable configuration and start server.

## Try it

```powershell
curl http://127.0.0.1:5000/logo --output logo.png
curl http://127.0.0.1:5000/stream
```

PowerShell equivalents:

```powershell
Invoke-WebRequest -Uri http://127.0.0.1:5000/logo -OutFile logo.png
Invoke-WebRequest -Uri http://127.0.0.1:5000/stream | Select -ExpandProperty Content
```

## Example routes

```powershell
# Logging
New-KrLogger | Add-KrSinkConsole | Register-KrLogger -Name 'console' -SetAsDefault

# Server
New-KrServer -Name 'Responses 9.3'

# Listener
Add-KrEndpoint -IPAddress '127.0.0.1' -Port 5000

# Runtime
Add-KrPowerShellRuntime

# Enable configuration
Enable-KrConfiguration

# Binary route: download file
Add-KrMapRoute -Pattern '/logo' -Verbs GET -ScriptBlock {
    $path = Resolve-KrPath -Pattern 'Assets/wwwroot/files/sample.bin' -KestrunRoot -Test
    if (Test-Path $path) {
        $bytes = [System.IO.File]::ReadAllBytes($path)
        Write-KrBinaryResponse -InputObject $bytes -ContentType 'application/octet-stream'
    } else {
        Write-KrErrorResponse -Message 'sample.bin not found' -StatusCode 404
    }
}

# Stream route: stream text file
Add-KrMapRoute -Pattern '/stream' -Verbs GET -ScriptBlock {
    $path = Resolve-KrPath -Pattern 'Assets/wwwroot/files/sample.txt' -KestrunRoot -Test
    if (Test-Path $path) {
        $fs = [System.IO.File]::OpenRead($path)
        Write-KrStreamResponse -InputObject $fs -ContentType 'text/plain'
    } else {
        Write-KrErrorResponse -Message 'sample.txt not found' -StatusCode 404
    }
}

# Start the server
Start-KrServer
```

### When to choose which

| Scenario | Helper |
|----------|--------|
| Small binary (< 1â€“2 MB) | `Write-KrBinaryResponse` |
| Large file on disk | `Write-KrStreamResponse` |
| Dynamically generated large data | Create a memory or pipe stream and use `Write-KrStreamResponse` |

### References

- [Write-KrBinaryResponse](/pwsh/cmdlets/Write-KrBinaryResponse)
- [Write-KrStreamResponse](/pwsh/cmdlets/Write-KrStreamResponse)

---

### Previous / Next

Previous: [Structured (XML / YAML / CSV)](./2.Structured-Xml-Yaml-Csv)
Next: [HTML Templates & Files](./4.Html-Templates-Files)

[9.3-Binary-Stream.ps1]: /pwsh/tutorial/examples/9.3-Binary-Stream.ps1
