---
title: Low-Level Response Stream
parent: Responses
nav_order: 9
---

# Low-Level Response Stream

`Write-KrResponse` exposes the raw body stream (currently typed for `System.IO.Stream`). Use only when higher-level helpers do not fit.

## Full source

File: [`pwsh/tutorial/examples/9.9-Low-Level-Response.ps1`][9.9-Low-Level-Response.ps1]

```powershell
{% include examples/pwsh/9.9-Low-Level-Response.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server named 'Responses 9.9'.
3. Listener: Listen on 127.0.0.1:5000.
4. Runtime: Add PowerShell runtime.
5. `/raw`: creates MemoryStream from UTF-8 bytes.
6. Calls `Write-KrResponse` to push raw stream with status 200.
7. Enable configuration and start server.

## Try it

```powershell
curl -i http://127.0.0.1:5000/raw
```

PowerShell equivalents:

```powershell
Invoke-WebRequest -Uri http://127.0.0.1:5000/raw     | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5000/manual  | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5000/pipeline | Select -Expand RawContent

# Streaming with .Content (auto-decoded UTF-8)
Invoke-WebRequest -Uri http://127.0.0.1:5000/raw | Select -Expand Content
```

## Example route

```powershell
# Logging
New-KrLogger | Add-KrSinkConsole | Register-KrLogger -Name 'console' -SetAsDefault

# Server
New-KrServer -Name 'Responses 9.9'

# Listener
Add-KrListener -IPAddress '127.0.0.1' -Port 5000

# Runtime
Add-KrPowerShellRuntime

# Enable configuration
Enable-KrConfiguration

# Raw stream route
Add-KrMapRoute -Pattern '/raw' -Verbs GET -ScriptBlock {
    $bytes = [System.Text.Encoding]::UTF8.GetBytes('raw-stream')
    $ms = New-Object System.IO.MemoryStream(,$bytes)
    Write-KrResponse -InputObject $ms -StatusCode 200
}

# Start the server
Start-KrServer
```

### When to use

| Situation | Rationale |
|-----------|-----------|
| Custom serialization pipeline | Encoder already writes to a stream |
| Chunked / progressive output | Manually control flush timing |
| Experimental formats | No dedicated helper yet |

### References

- [Write-KrResponse](/pwsh/cmdlets/Write-KrResponse)

---

### Previous / End

Previous: [Caching & Revalidation](./8.Caching)
You have reached the end of the Responses section. Return to the [Responses Overview](./index) or explore the next major topic.

[9.9-Low-Level-Response.ps1]: /pwsh/tutorial/examples/9.9-Low-Level-Response.ps1
