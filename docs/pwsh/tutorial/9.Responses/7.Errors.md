---
title: Errors
parent: Responses
nav_order: 7
---

# Error Responses

Use `Write-KrErrorResponse` for consistent failure payloads. Two parameter sets: message or exception.

## Full source

File: [`pwsh/tutorial/examples/9.7-Errors.ps1`][9.7-Errors.ps1]

```powershell
{% include examples/pwsh/9.7-Errors.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server named 'Responses 9.7'.
3. Listener: Listen on 127.0.0.1:5000.
4. Runtime: Add PowerShell runtime.
5. `/fail`: returns validation-style error (400) with details.
6. `/boom`: throws and catches exception, returns 500 with stack trace.
7. Enable configuration and start server.

## Try it

```powershell
curl -i http://127.0.0.1:5000/fail | jq
curl -i http://127.0.0.1:5000/boom | jq
```

PowerShell equivalents:

```powershell
curl -i http://127.0.0.1:5000/throw | jq
curl -i http://127.0.0.1:5000/not-found | jq
curl -i http://127.0.0.1:5000/failure | jq
curl -i http://127.0.0.1:5000/validation | jq

Invoke-WebRequest -Uri http://127.0.0.1:5000/throw -SkipHttpErrorCheck:$true | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5000/not-found -SkipHttpErrorCheck:$true | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5000/failure -SkipHttpErrorCheck:$true | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5000/validation -SkipHttpErrorCheck:$true | Select -Expand RawContent

# Or using Invoke-RestMethod (throws by default on non-success)
try { Invoke-RestMethod -Uri http://127.0.0.1:5000/not-found } catch { $_.Exception.Response.StatusCode }
```

## Example routes

```powershell
# Logging
New-KrLogger | Add-KrSinkConsole | Register-KrLogger -Name 'console' -SetAsDefault

# Server
New-KrServer -Name 'Responses 9.7'

# Listener
Add-KrListener -IPAddress '127.0.0.1' -Port 5000

# Runtime
Add-KrPowerShellRuntime

# Enable configuration
Enable-KrConfiguration

# Validation error route
Add-KrMapRoute -Pattern '/fail' -Verbs GET -ScriptBlock {
    Write-KrErrorResponse -Message 'Missing parameter' -StatusCode 400 -Details 'id required'
}

# Exception error route
Add-KrMapRoute -Pattern '/boom' -Verbs GET -ScriptBlock {
    try {
        throw [System.InvalidOperationException]::new('Exploded')
    } catch {
        Write-KrErrorResponse -Exception $_.Exception -StatusCode 500 -IncludeStack
    }
}

# Start the server
Start-KrServer
```

### References

- [Write-KrErrorResponse](/pwsh/cmdlets/Write-KrErrorResponse)

---

### Previous / Next

Previous: [Redirects](./6.Redirects)
Next: [Caching & Revalidation](./8.Caching)

[9.7-Errors.ps1]: /pwsh/tutorial/examples/9.7-Errors.ps1
