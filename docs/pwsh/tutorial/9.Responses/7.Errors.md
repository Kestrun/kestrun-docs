---
title: Errors
parent: Responses
nav_order: 7
---

# Error Responses

Use `Write-KrErrorResponse` for consistent failure payloads. Two parameter sets: message or exception.

## Full source

File: [`pwsh/tutorial/examples/9.7-Errors.ps1`][9.7-Errors.ps1]

```powershell
{% include examples/pwsh/9.7-Errors.ps1 %}
```

## Step-by-step

1. Server & listener on 5097.
2. `/fail`: returns validation-style error (400) with details.
3. `/boom`: throws and catches exception, returns 500 with stack trace.
4. Start server.

## Try it

```powershell
curl -i http://127.0.0.1:5097/fail | jq
curl -i http://127.0.0.1:5097/boom | jq
```

PowerShell equivalents:

```powershell
curl -i http://127.0.0.1:5097/throw | jq
curl -i http://127.0.0.1:5097/not-found | jq
curl -i http://127.0.0.1:5097/failure | jq
curl -i http://127.0.0.1:5097/validation | jq

Invoke-WebRequest -Uri http://127.0.0.1:5097/throw -SkipHttpErrorCheck:$true | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5097/not-found -SkipHttpErrorCheck:$true | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5097/failure -SkipHttpErrorCheck:$true | Select -Expand RawContent
Invoke-WebRequest -Uri http://127.0.0.1:5097/validation -SkipHttpErrorCheck:$true | Select -Expand RawContent

# Or using Invoke-RestMethod (throws by default on non-success)
try { Invoke-RestMethod -Uri http://127.0.0.1:5097/not-found } catch { $_.Exception.Response.StatusCode }
```

## Simple message

```powershell
Add-KrMapRoute -Path '/fail' -Method GET -ScriptBlock {
    Write-KrErrorResponse -Message 'Missing parameter' -StatusCode 400 -Details 'id query string required'
}
```

## Exception handling

```powershell
Add-KrMapRoute -Path '/boom' -Method GET -ScriptBlock {
    try {
        throw [System.InvalidOperationException]::new('Exploded')
    } catch {
        Write-KrErrorResponse -Exception $_.Exception -StatusCode 500 -IncludeStack
    }
}
```

### References

- [Write-KrErrorResponse](/pwsh/cmdlets/Write-KrErrorResponse)

---

### Previous / Next

Previous: [Redirects](./6.Redirects)
Next: [Caching & Revalidation](./8.Caching)

[9.7-Errors.ps1]: /pwsh/tutorial/examples/9.7-Errors.ps1
