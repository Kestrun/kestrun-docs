---
title: Text & JSON
parent: Responses
nav_order: 1
---

# Text & JSON Responses

Use `Write-KrTextResponse` for plain UTF-8 text and `Write-KrJsonResponse` for structured object data.

## Full source

File: [`pwsh/tutorial/examples/9.1-Text-Json.ps1`][9.1-Text-Json.ps1]

```powershell
{% include examples/pwsh/9.1-Text-Json.ps1 %}
```

## Step-by-step

1. Server & listener: create server and listen on `127.0.0.1:5000`.
2. Runtime: add PowerShell runtime so script block routes execute.
3. `/ping`: returns plain text using `Write-KrTextResponse`.
4. `/created`: shows custom status code (201) + explicit content type.
5. `/time`: pipes PSCustomObject into `Write-KrJsonResponse -Compress` producing compact JSON.
6. `/config`: demonstrates deeper nested object with default pretty JSON (no `-Compress`).
7. Start: `Enable-KrConfiguration` then `Start-KrServer`.

## Try it

```powershell
curl http://127.0.0.1:5000/ping
curl -X POST http://127.0.0.1:5000/created
curl http://127.0.0.1:5000/time | jq
curl http://127.0.0.1:5000/config | jq
```

PowerShell equivalents:

```powershell
Invoke-WebRequest -Uri http://127.0.0.1:5000/ping | Select-Object -ExpandProperty Content
Invoke-WebRequest -Uri http://127.0.0.1:5000/created -Method Post | Select-Object -ExpandProperty Content
Invoke-RestMethod -Uri http://127.0.0.1:5000/time   # auto-converts JSON
Invoke-RestMethod -Uri http://127.0.0.1:5000/config | Format-List
```

## Text

```powershell
Add-KrMapRoute -Path '/ping' -Method GET -ScriptBlock {
    Write-KrTextResponse 'pong'
}
```

### Custom status & content type

```powershell
Add-KrMapRoute -Path '/plain' -Method GET -ScriptBlock {
    Write-KrTextResponse -InputObject 'Created' -StatusCode 201 -ContentType 'text/plain; charset=utf-8'
}
```

## JSON

Pipe any object to `Write-KrJsonResponse`.

```powershell
Add-KrMapRoute -Path '/time' -Method GET -ScriptBlock {
    [pscustomobject]@{ utc = (Get-Date).ToUniversalTime(); version = 1 } | Write-KrJsonResponse -Compress
}
```

### Depth and compression

`-Depth` controls nested object traversal (default 10). `-Compress` removes whitespace for minimal payload.

```powershell
Add-KrMapRoute -Path '/config' -Method GET -ScriptBlock {
    $cfg = [pscustomobject]@{ name='demo'; features = @(1,2,3) }
    $cfg | Write-KrJsonResponse -Depth 5 -Compress -StatusCode 200
}
```

### Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| Empty body | Wrote outside a route | Ensure inside `Add-KrMapRoute -ScriptBlock {}` |
| Truncated JSON | Depth too small | Increase `-Depth` |
| Unexpected content type | Overridden upstream | Explicitly pass `-ContentType 'application/json'` |

### References

- [Write-KrTextResponse](/pwsh/cmdlets/Write-KrTextResponse)
- [Write-KrJsonResponse](/pwsh/cmdlets/Write-KrJsonResponse)

---

### Next

Continue to [Structured (XML / YAML / CSV)](./2.Structured-Xml-Yaml-Csv).

[9.1-Text-Json.ps1]: /pwsh/tutorial/examples/9.1-Text-Json.ps1
