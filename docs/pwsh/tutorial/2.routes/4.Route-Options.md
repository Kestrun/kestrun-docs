---
title: Route Options (MapRouteOptions)
parent: Routes
nav_order: 4
---

# Route Options (MapRouteOptions)

Use `MapRouteOptions` / `New-KrMapRouteOption` to configure routes with richer metadata, different languages, and advanced behaviors.

> Prerequisites: see [Introduction][Introduction].

## Full source

File: [`pwsh/tutorial/examples/2.4-Route-Options.ps1`][2.4-Route-Options.ps1]

```powershell
{% include examples/pwsh/2.4-Route-Options.ps1 %}
```

## Step-by-step

1. Base setup: `Initialize-KrRoot`, `New-KrServer`, `Add-KrListener`, `Add-KrPowerShellRuntime`,
    then `Enable-KrConfiguration`.
2. XML route (PowerShell):
    - `-Pattern '/xml/{message}'`; read with [Get-KrRequestRouteParam][Get-KrRequestRouteParam] -Name message.
    - Respond with [Write-KrXmlResponse][Write-KrXmlResponse].
3. YAML route (hashtable → [New-KrMapRouteOption][New-KrMapRouteOption]):
    - Compose an options object; set `DisableAntiforgery = $true`.
    - Pattern `/yaml`; since it has no `{message}` segment, route lookup returns `$null`.
4. JSON route (explicit .NET object):
    - Create `[Kestrun.Hosting.Options.MapRouteOptions]` and set verbs (`[Kestrun.Utilities.HttpVerb[]]`).
    - Read from a header via [Get-KrRequestHeader][Get-KrRequestHeader] and respond with [Write-KrJsonResponse][Write-KrJsonResponse].
5. Text route (C# code):
    - Options with `Language = 'CSharp'` and here-string code; access `Context.Request.Query`.
    - Use `Context.Response.WriteTextResponse` (C# extension method) to write plain text.
6. Mixed styles: freely mix `-ScriptBlock`, hashtable + [New-KrMapRouteOption][New-KrMapRouteOption],
    strongly-typed options, and C#/VB code.
7. Language selection: set `Language`; PowerShell is assumed when `-ScriptBlock` is used.
8. Antiforgery: use `DisableAntiforgery` to opt out per route if globally enabled.
9. Retrieving data: route params, headers, and query (from C# example) as shown above.

## When to use MapRouteOptions

Use `MapRouteOptions` when you need more than the simple `-Verbs -Path -ScriptBlock` shape:

- Provide inline code in another language (`Language`, `Code`).
- Configure route-level features like : DisableAntiforgery, CORS, or OpenAPI metadata.
- Programmatically build routes (e.g., in loops) using strongly typed objects.
- Share a common options template and adjust per route.

For quick, minimal routes the simple `Add-KrMapRoute -Verbs Get -Path ... -ScriptBlock {}` form remains fine.

## Try it

Save the sample locally so it’s easy to run. Copy the contents of
[`pwsh/tutorial/examples/2.4-Route-Options.ps1`][2.4-Route-Options.ps1]
into a new file in an empty working folder (for example, `route-options.ps1`), then run:

```powershell
# From your working folder
pwsh .\route-options.ps1
```

Invoke each route:

```powershell
curl http://127.0.0.1:5000/xml/HelloXml
curl http://127.0.0.1:5000/yaml            # will show null message unless you change pattern
curl -H "message: HelloHeader" http://127.0.0.1:5000/json
curl http://127.0.0.1:5000/txt?message=HelloQuery
```

PowerShell equivalents:

```powershell
Invoke-WebRequest -Uri 'http://127.0.0.1:5000/xml/HelloXml' | Select-Object -ExpandProperty Content
Invoke-WebRequest -Uri 'http://127.0.0.1:5000/yaml'         | Select-Object -ExpandProperty Content
Invoke-WebRequest -Uri 'http://127.0.0.1:5000/json' -Headers @{ message = 'HelloHeader' } | Select-Object -ExpandProperty Content
Invoke-WebRequest -Uri 'http://127.0.0.1:5000/txt?message=HelloQuery' | Select-Object -ExpandProperty Content
```

## Cmdlet / API references

- [Add-KrMapRoute][Add-KrMapRoute]
- [New-KrMapRouteOption][New-KrMapRouteOption]
- [Get-KrRequestRouteParam][Get-KrRequestRouteParam]
- [Get-KrRequestHeader][Get-KrRequestHeader]
- [Write-KrXmlResponse][Write-KrXmlResponse]
- [Write-KrYamlResponse][Write-KrYamlResponse]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [Start-KrServer][Start-KrServer]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]

## Troubleshooting

| Symptom                             | Cause                                     | Fix                                                              |
|-------------------------------------|-------------------------------------------|------------------------------------------------------------------|
| `$message` is `$null` on `/yaml`    | Pattern lacks `{message}`                 | Change pattern to `/yaml/{message}` or use query/header instead  |
| Header message not found on `/json` | Missing `message` header                  | Add `-H "message: value"` or use `Get-KrRequestRouteParam`/query |
| C# route errors                     | Typos or missing semicolon in here‑string | Validate C# snippet; keep indentation simple                     |
| 404 Not Found                       | Route not mapped or verb mismatch         | Confirm verb list includes the HTTP method (e.g., GET)           |

---

### Next

{: .fs-4 .fw-500}

Continue to [Route Groups][Next] or explore more advanced patterns with middleware later in the tutorial.

[2.4-Route-Options.ps1]: /pwsh/tutorial/examples/2.4-Route-Options.ps1
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[New-KrMapRouteOption]: /pwsh/cmdlets/New-KrMapRouteOption
[Get-KrRequestRouteParam]: /pwsh/cmdlets/Get-KrRequestRouteParam
[Get-KrRequestHeader]: /pwsh/cmdlets/Get-KrRequestHeader
[Write-KrXmlResponse]: /pwsh/cmdlets/Write-KrXmlResponse
[Write-KrYamlResponse]: /pwsh/cmdlets/Write-KrYamlResponse
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Next]: ./5.Route-Groups
[Introduction]: ../1.introduction/index#prerequisites
