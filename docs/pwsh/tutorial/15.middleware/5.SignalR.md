---
title: SignalR
parent: Middleware
nav_order: 5
---

# SignalR

Add real-time, bidirectional communication to your server for live events, progress, and notifications using SignalR.

## Full source

File: [`pwsh/tutorial/examples/15.5-SignalR.ps1`][15.5-SignalR.ps1]

```powershell
{% include examples/pwsh/15.5-SignalR.ps1 %}
```

## Step-by-step

1. Logging: Register a console logger as the default.
2. Server: Create a server named 'Kestrun SignalR Demo'.
3. Listener: Listen on 127.0.0.1:5000.
4. SignalR: Add the SignalR hub middleware at `/hubs/kestrun`.
5. Services: Add the Scheduler and ad-hoc Tasks service for background work.
6. Configuration: Enable configuration to materialize middleware and services.
7. Routes: Map routes to broadcast logs/events, join/leave/broadcast groups, start a long operation, and poll operation status; serve an HTML demo at `/`.
8. Run: Start the server and connect a client to the hub at `/hubs/kestrun`.

## Try it

Start the sample script (runs until stopped):

```powershell
pwsh .\docs\_includes\examples\pwsh\15.5-SignalR.ps1
```

Broadcast a log and a custom event:

```powershell
# Broadcast an Information log
curl -i http://127.0.0.1:5000/api/ps/log/Information

# Broadcast a custom event
curl -i http://127.0.0.1:5000/api/ps/event
```

Group operations and group broadcast:

```powershell
# Request join/leave of a group (demo events)
curl -i -X POST http://127.0.0.1:5000/api/group/join/Admins
curl -i -X POST http://127.0.0.1:5000/api/group/leave/Admins

# Broadcast a message to a group
curl -i -X POST http://127.0.0.1:5000/api/group/broadcast/Admins
```

Long operation with progress and completion:

```powershell
# Start a 4-second operation
$start = Invoke-RestMethod -Uri 'http://127.0.0.1:5000/api/operation/start?seconds=4' -Method Post
$taskId = $start.TaskId

# Poll status until completed
do {
  Start-Sleep -Milliseconds 500
  $status = Invoke-RestMethod -Uri "http://127.0.0.1:5000/api/operation/status/$taskId"
  "Progress=$($status.Progress)% State=$($status.State) Status=$($status.Status)"
} while ($status.State -notin @('Completed','Faulted','Canceled'))
```

Open the HTML client demo to see live updates:

```powershell
Start-Process http://127.0.0.1:5000/
```

## Key Points

- The default hub path in this sample is `/hubs/kestrun`.
- Use `Send-KrSignalRLog` and `Send-KrSignalREvent` to broadcast to all clients; use `Send-KrSignalRGroupMessage` to target groups.
- For long operations, pair `New-KrTask` with periodic `Send-KrSignalREvent` messages like `OperationProgress` and `OperationComplete`.
- The HTML client handles both TaskId-first IDs and robust parsing of non-JSON responses.

## References

- [Initialize-KrRoot][Initialize-KrRoot]
- [New-KrLogger][New-KrLogger]
- [Add-KrSinkConsole][Add-KrSinkConsole]
- [Register-KrLogger][Register-KrLogger]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Add-KrSignalRHubMiddleware][Add-KrSignalRHubMiddleware]
- [Add-KrScheduling][Add-KrScheduling]
- [Add-KrTasksService][Add-KrTasksService]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrHtmlTemplateRoute][Add-KrHtmlTemplateRoute]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Get-KrRequestRouteParam][Get-KrRequestRouteParam]
- [Get-KrRequestQuery][Get-KrRequestQuery]
- [Write-KrTextResponse][Write-KrTextResponse]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [Write-KrLog][Write-KrLog]
- [Send-KrSignalRLog][Send-KrSignalRLog]
- [Send-KrSignalREvent][Send-KrSignalREvent]
- [Send-KrSignalRGroupMessage][Send-KrSignalRGroupMessage]
- [New-KrTask][New-KrTask]
- [Set-KrTaskName][Set-KrTaskName]
- [Get-KrTask][Get-KrTask]
- [Register-KrSchedule][Register-KrSchedule]
- [Start-KrServer][Start-KrServer]
- [SignalR Topic][SignalR Topic]

## Troubleshooting

| Symptom | Cause | Fix |
|--------|-------|-----|
| Hub fails to connect | Wrong path | Use `/hubs/kestrun` in clients to match the sample |
| No messages received | Client not subscribed | Ensure handlers are registered for `ReceiveLog` and `ReceiveEvent` |
| Progress never reaches 100% | Seconds not an integer | Pass `seconds` as an integer; sample scales percent by `i * 100 / seconds` |
| 404 on status endpoint | Wrong TaskId | Use the `TaskId` returned by `/api/operation/start` |

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [HTTPS and HSTS Security](./4.Https-Hsts)
Next: _None_

[15.5-SignalR.ps1]: /pwsh/tutorial/examples/15.5-SignalR.ps1
[Initialize-KrRoot]: /pwsh/cmdlets/Initialize-KrRoot
[New-KrLogger]: /pwsh/cmdlets/New-KrLogger
[Add-KrSinkConsole]: /pwsh/cmdlets/Add-KrSinkConsole
[Register-KrLogger]: /pwsh/cmdlets/Register-KrLogger
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Add-KrSignalRHubMiddleware]: /pwsh/cmdlets/Add-KrSignalRHubMiddleware
[Add-KrScheduling]: /pwsh/cmdlets/Add-KrScheduling
[Add-KrTasksService]: /pwsh/cmdlets/Add-KrTasksService
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrHtmlTemplateRoute]: /pwsh/cmdlets/Add-KrHtmlTemplateRoute
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Get-KrRequestRouteParam]: /pwsh/cmdlets/Get-KrRequestRouteParam
[Get-KrRequestQuery]: /pwsh/cmdlets/Get-KrRequestQuery
[Write-KrTextResponse]: /pwsh/cmdlets/Write-KrTextResponse
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[Write-KrLog]: /pwsh/cmdlets/Write-KrLog
[Send-KrSignalRLog]: /pwsh/cmdlets/Send-KrSignalRLog
[Send-KrSignalREvent]: /pwsh/cmdlets/Send-KrSignalREvent
[Send-KrSignalRGroupMessage]: /pwsh/cmdlets/Send-KrSignalRGroupMessage
[New-KrTask]: /pwsh/cmdlets/New-KrTask
[Set-KrTaskName]: /pwsh/cmdlets/Set-KrTaskName
[Get-KrTask]: /pwsh/cmdlets/Get-KrTask
[Register-KrSchedule]: /pwsh/cmdlets/Register-KrSchedule
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[SignalR Topic]: /guides/signalr
