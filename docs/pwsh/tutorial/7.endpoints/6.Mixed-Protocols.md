---
title: Mixed HTTP Protocols
parent: Endpoints
nav_order: 6
---

# Mixed HTTP Protocols

Expose the same application over multiple listeners each constrained to a specific HTTP protocol version
(HTTP/1.1, HTTP/2, HTTP/3), plus an example of a combined protocol listener.

> HTTP/3 requires: PowerShell 7.6+, .NET 8/9 with QUIC enabled,
> and OS support (Windows Server 2022 / Windows 11 recent build,
> or modern Linux with QUIC). If unavailable the listener will fail or downgrade.

## Full source

File: [`pwsh/tutorial/examples/7.6-Mixed-HttpProtocols.ps1`][7.6-Mixed-HttpProtocols.ps1]

```powershell
{% include examples/pwsh/7.6-Mixed-HttpProtocols.ps1 %}
```

## Step-by-step

1. Create server & logger.
2. Add four listeners with explicit `-Protocols` values: `Http1`, `Http2`, `Http3`, and `Http1AndHttp2` (combined).
3. Add PowerShell runtime.
4. Enable configuration.
5. Map `/version` route returning negotiated protocol.
6. Start server.

## Try it

```powershell
curl -v --http1.1 http://127.0.0.1:5001/version
curl -v --http2-prior-knowledge http://127.0.0.1:5002/version
# HTTP/3 (requires curl built with ngtcp2/openssl/quiche etc.):
curl -v --http3 http://127.0.0.1:5003/version
# Combined (will respond; protocol shows actual negotiated version or HTTP/1.1 without TLS):
curl -v http://127.0.0.1:5004/version
```

Each response prints: `Hello via HTTP/<version>`.

### Enum values

`[Microsoft.AspNetCore.Server.Kestrel.Core.HttpProtocols]` supports: `Http1`, `Http2`, `Http3`, and flag combinations
(`Http1AndHttp2`, `Http1AndHttp3`, `Http2AndHttp3`, `Http1AndHttp2AndHttp3`). You can also combine flags manually:

```powershell
$all = [Microsoft.AspNetCore.Server.Kestrel.Core.HttpProtocols]::Http1 -bor \
    [Microsoft.AspNetCore.Server.Kestrel.Core.HttpProtocols]::Http2 -bor \
    [Microsoft.AspNetCore.Server.Kestrel.Core.HttpProtocols]::Http3
Add-KrListener -Port 5010 -IPAddress ([IPAddress]::Loopback) -Protocols $all
```

> HTTP/2 generally requires TLS in browsers; HTTP/3 always requires QUIC + TLS.

## Cmdlet references

- [Add-KrListener][Add-KrListener]
- [New-KrServer][New-KrServer]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Start-KrServer][Start-KrServer]

## Troubleshooting

| Symptom                   | Cause                | Fix                                      |
| ------------------------- | -------------------- | ---------------------------------------- |
| HTTP/3 listener fails     | QUIC not supported   | Remove HTTP/3 line or upgrade OS/runtime |
| All versions say HTTP/1.1 | H2/H3 not negotiated | Use proper curl flags or ALPN support    |
| Port in use               | Already bound        | Change port numbers                      |

See also: [Multiple Listeners](./2.Multiple-Listeners) Â· [HTTPS](./3.Https)

---

### Next

Continue to [Server Configuration](../13.server-configuration/index) or [Authentication](../8.authentication/index).

[7.6-Mixed-HttpProtocols.ps1]: /pwsh/tutorial/examples/pwsh/7.6-Mixed-HttpProtocols.ps1
[Add-KrListener]: /pwsh/cmdlets/Add-KrListener
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
