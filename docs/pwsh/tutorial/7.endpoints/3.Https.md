---
title: HTTPS & Certificates
parent: Endpoints
nav_order: 3
---

# HTTPS & Certificates

Add TLS with a development self‑signed certificate or an existing PFX.

> Prerequisites: see [Certificates section](../6.certificates/index) for creating a self‑signed cert.

## Full source

File: [`pwsh/tutorial/examples/7.3-Https.ps1`][7.3-Https.ps1]

```powershell
{% include examples/pwsh/7.3-Https.ps1 %}
```

## Step-by-step

1. Ensure / create PFX (dev only) with `New-KrSelfSignedCertificate`.
2. Add HTTP listener (optional) and HTTPS listener with `-CertPath/-CertPassword`.
3. Add runtime + enable config.
4. Map `/secure` route with `-Endpoints` parameter to bind to HTTPS listener only.
5. Map `/unsecure` route with `-Endpoints` parameter to bind to HTTP listener only.
6. Start server.
7. (Optional) Tune via `Set-KrServerHttpsOptions` for protocols or client certificate mode.

## Endpoint-specific routing

The `-Endpoints` parameter in `Add-KrMapRoute` allows you to bind routes to specific listeners:

```powershell
# Secure route - only available on HTTPS listener
Add-KrMapRoute -Verbs Get -Pattern '/secure' -Endpoints "127.0.0.1:5443" -ScriptBlock {
    Write-KrTextResponse -InputObject 'Secure hello' -StatusCode 200
}

# Unsecure route - only available on HTTP listener
Add-KrMapRoute -Verbs Get -Pattern '/unsecure' -Endpoints "127.0.0.1:5000" -ScriptBlock {
    Write-KrTextResponse -InputObject 'Unsecure hello' -StatusCode 200
}
```

**Key points:**

- Format: `"IPAddress:Port"` (e.g., `"127.0.0.1:5443"`)
- Without `-Endpoints`, routes are available on all listeners
- Use this to enforce HTTPS-only routes or separate HTTP/HTTPS functionality

## Try it

```powershell
curl -k https://127.0.0.1:5443/secure

Invoke-WebRequest -Uri https://127.0.0.1:5443/secure -SkipCertificateCheck | Select-Object -ExpandProperty Content
```

`-k` skips trust validation for an untrusted self‑signed cert.

## Cmdlet references

- [New-KrSelfSignedCertificate][New-KrSelfSignedCertificate]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Set-KrServerHttpsOptions][Set-KrServerHttpsOptions]
- [Start-KrServer][Start-KrServer]

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| curl cert warning | Self-signed cert | Use `-k` or trust cert locally |
| HTTPS listener fails | Wrong password | Re-enter secure string / recreate PFX |
| Route works on HTTP not HTTPS | Only added HTTP listener | Add second listener before enabling config |
| Route not accessible on expected endpoint | Wrong `-Endpoints` parameter | Check IP:Port format matches listener |
| Route accessible on wrong protocol | Missing `-Endpoints` parameter | Add `-Endpoints` to bind to specific listener |

See also: [Certificates](../6.certificates/index) · [Logging](../5.logging/index)

---

### Next

Continue to [Named Pipes](./4.Named-Pipes).

[7.3-Https.ps1]: /pwsh/tutorial/examples/7.3-Https.ps1
[New-KrSelfSignedCertificate]: /pwsh/cmdlets/New-KrSelfSignedCertificate
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Set-KrServerHttpsOptions]: /pwsh/cmdlets/Set-KrServerHttpsOptions
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
