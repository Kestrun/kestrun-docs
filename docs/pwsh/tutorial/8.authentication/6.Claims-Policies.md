---
title: Claims & Policies
parent: Authentication
nav_order: 6
---

# Claims & Policies

Define claim-based authorization rules and enforce them per route.

## Full source

File: [`pwsh/tutorial/examples/8.6-Claims-Policies.ps1`][8.6-Claims-Policies.ps1]

```powershell
{% include examples/pwsh/8.6-Claims-Policies.ps1 %}
```

## Step-by-step

1. Build claim policy config (`New-KrClaimPolicy` + `Add-KrClaimPolicy`).
2. Basic auth scheme issues claims for admin.
3. Enable configuration.
4. Map policy-specific routes requiring CanRead/CanWrite/etc.
5. Start server.

## Try it

```powershell
$b = 'Basic ' + [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes('admin:password'))
Invoke-WebRequest http://127.0.0.1:5000/secure/policy/read -Headers @{Authorization=$b}
```

## Cmdlet references

- [New-KrClaimPolicy][New-KrClaimPolicy]
- [Add-KrClaimPolicy][Add-KrClaimPolicy]
- [Add-KrBasicAuthentication][Add-KrBasicAuthentication]
- [Add-KrMapRoute][Add-KrMapRoute]
- [New-KrServer][New-KrServer]
- [Enable-KrConfiguration][Enable-KrConfiguration]

## Troubleshooting

| Symptom       | Cause                             | Fix                              |
| ------------- | --------------------------------- | -------------------------------- |
| 403 Forbidden | Missing required claim            | Ensure issuing scheme sets claim |
| 401 then 403  | Unauthenticated then unauthorized | Add correct Authorization header |

---

### Next

Continue to [Multiple Schemes](./7.Multiple-Schemes).

[8.6-Claims-Policies.ps1]: /pwsh/tutorial/examples/8.6-Claims-Policies.ps1
[New-KrClaimPolicy]: /pwsh/cmdlets/New-KrClaimPolicy
[Add-KrClaimPolicy]: /pwsh/cmdlets/Add-KrClaimPolicy
[Add-KrBasicAuthentication]: /pwsh/cmdlets/Add-KrBasicAuthentication
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
