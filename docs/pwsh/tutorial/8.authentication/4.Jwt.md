---
title: JWT Tokens
parent: Authentication
nav_order: 4
---

# JWT Tokens

Issue and validate bearer tokens for stateless auth.

## Full source

File: [`pwsh/tutorial/examples/8.4-Jwt.ps1`][8.4-Jwt.ps1]

```powershell
{% include examples/pwsh/8.4-Jwt.ps1 %}
```

## Step-by-step

1. Create builder (`New-KrJWTBuilder`) with issuer/audience & HMAC protection.
2. Add Basic scheme to authenticate initial user.
3. Map `/token/new` route issuing token with claims.
4. Configure JWT bearer scheme with validation parameters.
5. Protect `/secure/jwt/hello` & policy routes.
6. Start server.

## Try it

```powershell
$b = 'Basic ' + [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes('admin:password'))
$token = (Invoke-RestMethod http://127.0.0.1:5000/token/new -Headers @{Authorization=$b}).access_token
Invoke-RestMethod http://127.0.0.1:5000/secure/jwt/hello -Headers @{Authorization = "Bearer $token"}
```

## Cmdlet references

-   [New-KrJWTBuilder][New-KrJWTBuilder]
-   [Add-KrJWTIssuer][Add-KrJWTIssuer]
-   [Add-KrJWTAudience][Add-KrJWTAudience]
-   [Protect-KrJWT][Protect-KrJWT]
-   [Build-KrJWT][Build-KrJWT]
-   [Get-KrJWTValidationParameter][Get-KrJWTValidationParameter]
-   [Add-KrJWTBearerAuthentication][Add-KrJWTBearerAuthentication]
-   [Add-KrBasicAuthentication][Add-KrBasicAuthentication]
-   [Add-KrMapRoute][Add-KrMapRoute]
-   [Start-KrServer][Start-KrServer]

## Troubleshooting

| Symptom           | Cause                    | Fix                                     |
| ----------------- | ------------------------ | --------------------------------------- |
| 401 Bearer        | Missing or invalid token | Provide `Authorization: Bearer <token>` |
| Token expired     | Expiration passed        | Re-issue token via `/token/new`         |
| Signature invalid | Wrong key/algorithm      | Ensure same secret & algorithm          |

---

### Next

Continue to [Cookies](./5.Cookies).

[8.4-Jwt.ps1]: /pwsh/tutorial/examples/8.4-Jwt.ps1
[New-KrJWTBuilder]: /pwsh/cmdlets/New-KrJWTBuilder
[Add-KrJWTIssuer]: /pwsh/cmdlets/Add-KrJWTIssuer
[Add-KrJWTAudience]: /pwsh/cmdlets/Add-KrJWTAudience
[Protect-KrJWT]: /pwsh/cmdlets/Protect-KrJWT
[Build-KrJWT]: /pwsh/cmdlets/Build-KrJWT
[Get-KrJWTValidationParameter]: /pwsh/cmdlets/Get-KrJWTValidationParameter
[Add-KrJWTBearerAuthentication]: /pwsh/cmdlets/Add-KrJWTBearerAuthentication
[Add-KrBasicAuthentication]: /pwsh/cmdlets/Add-KrBasicAuthentication
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
