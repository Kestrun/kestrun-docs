---
title: Windows Authentication
parent: Authentication
nav_order: 6
---

# Windows Authentication

Leverage the host (Windows / Active Directory) credentials for transparent authentication.
This chapter shows enabling integrated auth and reading the resulting principal.

## Full source

File: [`pwsh/tutorial/examples/8.6-Windows-Authentication.ps1`][8.6-Windows-Authentication.ps1]

```powershell
{% include examples/pwsh/8.6-Windows-Authentication.ps1 %}
```

## Step-by-step

1. Logger: Register console logger as default.
2. Server: Create server named "Auth Claims" (reused naming from earlier sample).
3. Listener: Add HTTPS listener (loopback 5000) with self-signed certificate.
4. Windows auth: Enable with `Add-KrWindowsAuthentication` (negotiates with the client).
5. Enable config: `Enable-KrConfiguration` finalizes the pipeline.
6. Route: Root `/` returns a confirmation including the identity name.
7. Start: Launch server with `Start-KrServer`.

## Accessing the identity

Within a route you can read:

```powershell
$Context.User.Identity.Name
```

If the client negotiated successfully this contains the Windows (domain) user.

## Try it

Invoke from a Windows client (PowerShell will automatically send current credentials
when using `Invoke-WebRequest` with default settings for trusted loopback):

```powershell
Invoke-WebRequest https://127.0.0.1:5000/ -SkipCertificateCheck | Select -Expand Content
```

To test an alternate identity, run the PowerShell session with `runas` or launch a browser
in a different user context and browse to the same URL.

## References

- [Add-KrWindowsAuthentication][Add-KrWindowsAuthentication]
- [Add-KrMapRoute][Add-KrMapRoute]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Start-KrServer][Start-KrServer]
- [Register-KrLogger][Register-KrLogger]
- [Add-KrSinkConsole][Add-KrSinkConsole]

## Troubleshooting

| Symptom             | Cause                            | Fix / Action                                        |
| ------------------- | -------------------------------- | --------------------------------------------------- |
| 401 Unauthorized    | Negotiation failed / unsupported | Use a client supporting Windows auth (IE/Edge)      |
| Empty identity name | Auth not applied to route        | Ensure auth enabled before `Enable-KrConfiguration` |
| Cert warnings       | Self-signed certificate in use   | Trust cert or supply valid cert                     |

## Notes

- Windows authentication is only supported on Windows hosts.
- Use claims/policies chapter if you need authorization beyond identity presence.
- Combine with other schemes using route groups if partial site needs Windows auth.

---

### Previous / Next

{: .fs-4 .fw-500}

- Previous: [Cookies][Prev]
- Next: [Claims & Policies][Next]

[8.6-Windows-Authentication.ps1]: /pwsh/tutorial/examples/8.6-Windows-Authentication.ps1
[Add-KrWindowsAuthentication]: /pwsh/cmdlets/Add-KrWindowsAuthentication
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[Register-KrLogger]: /pwsh/cmdlets/Register-KrLogger
[Add-KrSinkConsole]: /pwsh/cmdlets/Add-KrSinkConsole
[Prev]: ./5.Cookies
[Next]: ./7.Claims-Policies
