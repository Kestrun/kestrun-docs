---
title: OpenID Connect (Okta)
parent: Authentication
nav_order: 9
---

# OpenID Connect (Okta)

Add Okta login using the authorization code flow with PKCE and persist the session via cookies.

> See also: Provider setup checklist in the [OIDC guide](/guides/authentication/oidc#10-provider-setup-checklist).

## Full source

File: [`pwsh/tutorial/examples/8.9-Oidc-OktaSample.ps1`][8.9-Oidc-OktaSample.ps1]

```powershell
{% include examples/pwsh/8.9-Oidc-OktaSample.ps1 %}
```

## Step-by-step

1. Logging: Register console logger at Debug.
2. Server: Create server named 'Auth Okta Demo'.
3. Listener: Bind self-signed HTTPS on the specified port.
4. OIDC: Configure authority, client id/secret, callback path, PKCE, scopes (`openid`, `profile`, `email`).
5. Scheme: Register with `Add-KrOpenIdConnectAuthentication -AuthenticationScheme 'Okta'`.
6. Configuration: Call `Enable-KrConfiguration`.
7. Routes: Public landing, `/login` challenge (Okta), `/me` protected info, and sign-out routes.
8. Start: Run the server.

## Try it

```powershell
# Set environment variables (replace with your Okta app values)
$env:OKTA_CLIENT_ID = 'your-client-id'
$env:OKTA_CLIENT_SECRET = 'your-client-secret'
$env:OKTA_AUTHORITY = 'https://your-domain.okta.com'

# Start sample from repo root
pwsh docs/_includes/examples/pwsh/8.9-Oidc-OktaSample.ps1
```

```powershell
# After login, inspect the current user
Invoke-WebRequest https://localhost:5000/me -SkipCertificateCheck | Select -Expand Content
```

## Troubleshooting

| Symptom | Cause | Resolution |
| --- | --- | --- |
| Callback error | Redirect URI mismatch | Ensure your Okta app lists `https://localhost:5000/signin-oidc` (or your chosen `-CallbackPath`). |
| Empty user claims | Minimal scopes granted | Add `email` scope and set `-GetClaimsFromUserInfoEndpoint` (enabled in sample). |
| Sign-out doesn’t redirect | Missing post-logout redirect | The sample computes `/signout` URL; verify it’s allowed in Okta settings. |

## References

- [Add-KrOpenIdConnectAuthentication][Add-KrOpenIdConnectAuthentication]
- [Invoke-KrChallenge][Invoke-KrChallenge]
- [Invoke-KrCookieSignOut][Invoke-KrCookieSignOut]
- [Add-KrMapRoute][Add-KrMapRoute]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Start-KrServer][Start-KrServer]

---

### Previous / Next

{: .fs-4 .fw-500}

- Previous: [Claims & Policies][Prev]
- Next: [Multiple Schemes][Next]

[8.9-Oidc-OktaSample.ps1]: /pwsh/tutorial/examples/8.9-Oidc-OktaSample.ps1
[Add-KrOpenIdConnectAuthentication]: /pwsh/cmdlets/Add-KrOpenIdConnectAuthentication
[Invoke-KrChallenge]: /pwsh/cmdlets/Invoke-KrChallenge
[Invoke-KrCookieSignOut]: /pwsh/cmdlets/Invoke-KrCookieSignOut
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[Prev]: ./7.Claims-Policies
[Next]: ./10.Multiple-Schemes
