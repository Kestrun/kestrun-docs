---
title: Cookies
parent: Authentication
nav_order: 5
---

# Cookies Authentication

Maintain user sessions with form login + secure cookie.

## Full source

File: [`pwsh/tutorial/examples/8.5-Cookies.ps1`][8.5-Cookies.ps1]

```powershell
{% include examples/pwsh/8.5-Cookies.ps1 %}
```

## Step-by-step

1. Create server & listener.
2. Define cookie scheme with login/logout paths.
3. Enable configuration.
4. Map `/cookies/login` (form) & protected `/secure/cookies/hello`.
5. Start server.

## Try it

```powershell
$session = New-Object Microsoft.PowerShell.Commands.WebRequestSession
Invoke-WebRequest -Uri http://127.0.0.1:5000/cookies/login -Method Post -Body @{username='admin';password='secret'} -WebSession $session
Invoke-WebRequest -Uri http://127.0.0.1:5000/secure/cookies/hello -WebSession $session | Select -Expand Content
```

## Cmdlet references

- [Add-KrCookiesAuthentication][Add-KrCookiesAuthentication]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Add-KrRouteGroup][Add-KrRouteGroup]
- [New-KrServer][New-KrServer]
- [Add-KrListener][Add-KrListener]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Start-KrServer][Start-KrServer]

## Troubleshooting

| Symptom            | Cause                   | Fix                                |
| ------------------ | ----------------------- | ---------------------------------- |
| 401 after login    | Session not stored      | Reuse same WebRequestSession       |
| Cookie missing     | Secure / HTTPS mismatch | Use HTTPS or adjust `SecurePolicy` |
| Login always fails | Credential check logic  | Inspect form parsing               |

---

### Next

Continue to [Claims & Policies](./6.Claims-Policies).

[8.5-Cookies.ps1]: /pwsh/tutorial/examples/8.5-Cookies.ps1
[Add-KrCookiesAuthentication]: /pwsh/cmdlets/Add-KrCookiesAuthentication
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Add-KrRouteGroup]: /pwsh/cmdlets/Add-KrRouteGroup
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrListener]: /pwsh/cmdlets/Add-KrListener
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
