---
title: GitHub Authentication
parent: Authentication
nav_order: 11
---

# GitHub Authentication

Enable GitHub OAuth login with a ready-made wrapper that configures PKCE, token persistence, and session cookie forwarding.

> See also: Provider setup checklist in the [OAuth 2.0 guide](/guides/authentication/oauth2#81-provider-setup-checklist).

## Full source

File: [`pwsh/tutorial/examples/8.10-GitHubAuthentication.ps1`][8.10-GitHubAuthentication.ps1]

```powershell
{% include examples/pwsh/8.10-GitHubAuthentication.ps1 %}
```

## Step-by-step

1. Logger: Register a console logger at Debug so auth and pipeline events are visible.
2. Server: Create a server named 'GitHub Authentication Demo'.
3. Listener: Bind a self-signed HTTPS endpoint on loopback and chosen port (5000 default).
4. Auth: Call `Add-KrGitHubAuthentication` â€“ registers base, cookie, and policy schemes plus PKCE and scope defaults.
  Default callback is `/signin-oauth`; override with `-CallbackPath` to match your GitHub App.
5. Configuration: Finalize middleware with `Enable-KrConfiguration`.
6. Routes: Public landing + protected routes using `-AuthorizationScheme 'GitHub'` (policy scheme forwards challenge to GitHub and authenticates via cookie).
7. Email enrichment: Automatically fetches primary/verified email if absent and scope `user:email` granted.
8. Start: Launch the server with `Start-KrServer`.

## Try it

```powershell
# Set secrets first (replace placeholders)
$env:GITHUB_CLIENT_ID = 'your-client-id'
$env:GITHUB_CLIENT_SECRET = 'your-client-secret'

# Start script (from repo root)
pwsh docs/_includes/examples/pwsh/8.10-GitHubAuthentication.ps1
```

```powershell
# After browser login, inspect claims via API
Invoke-WebRequest https://localhost:5000/github/me -SkipCertificateCheck | Select -Expand Content
```

## Key Points

- Three schemes: `GitHub`, `GitHub.Cookies`, `GitHub.Policy` (use `-AuthorizationScheme 'GitHub'` on protected routes).
- PKCE is on by default for the authorization code flow.
- Default scopes include `read:user` and `user:email`; add more with `-Scope`.
- Email claim added only if missing and consented (`user:email` scope); disable via `-DisableEmailEnrichment`.
- Cookie scheme isolates session persistence from remote challenge logic.
- The GitHub OAuth App callback must match `https://localhost:<port><CallbackPath>`.
  Default path is `/signin-oauth` (as used in the sample). Change with `-CallbackPath` if your app differs.

## Troubleshooting

| Symptom | Cause | Resolution |
| ------- | ----- | ---------- |
| No email claim | Scope not granted or email private | Include `user:email` scope and ensure account has a primary email |
| 410 Gone on userinfo | Wrong endpoint or missing User-Agent | Wrapper uses `https://api.github.com/user` with UA; check network |
| Infinite redirect loop | Callback mismatch | Set callback to `https://localhost:5011/signin-github` in GitHub App settings |
| Avatar claim missing | Field absent or mapping overridden | Ensure wrapper not replaced; verify `/user` JSON |

## References

- [Add-KrGitHubAuthentication][Add-KrGitHubAuthentication]
- [Add-KrOAuth2Authentication][Add-KrOAuth2Authentication]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Add-KrRouteGroup][Add-KrRouteGroup]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Start-KrServer][Start-KrServer]
- [Register-KrLogger][Register-KrLogger]
- [Set-KrLoggerLevel][Set-KrLoggerLevel]
- [Add-KrSinkConsole][Add-KrSinkConsole]

---

### Previous / Next

{: .fs-4 .fw-500}

- Previous: [Multiple Schemes][Prev]
- Next: [OpenID Connect (Duende Demo)][Next]

[8.10-GitHubAuthentication.ps1]: /pwsh/tutorial/examples/8.10-GitHubAuthentication.ps1
[Add-KrGitHubAuthentication]: /pwsh/cmdlets/Add-KrGitHubAuthentication
[Add-KrOAuth2Authentication]: /pwsh/cmdlets/Add-KrOAuth2Authentication
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Add-KrRouteGroup]: /pwsh/cmdlets/Add-KrRouteGroup
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[Register-KrLogger]: /pwsh/cmdlets/Register-KrLogger
[Set-KrLoggerLevel]: /pwsh/cmdlets/Set-KrLoggerLevel
[Add-KrSinkConsole]: /pwsh/cmdlets/Add-KrSinkConsole
[Prev]: ./10.Multiple-Schemes
[Next]: ./12.OpenID-Connect
