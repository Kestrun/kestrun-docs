---
title: File Server & Directory Browsing
parent: Static Routes
nav_order: 2
---

# File Server & Directory Browsing

Serve an entire directory tree (optionally at the site root) with automatic directory listings.

> Prerequisites: see [Introduction][Introduction].

## Full source

File: [`examples/PowerShell/Tutorial/3.2-File-Server.ps1`][3.2-File-Server.ps1]

```powershell
<#
   Sample Kestrun Server on how to configure a static file server.
   Demonstrates directory browsing and custom content type mappings.
   FileName: 3.2-File-Server.ps1
#>

# Import the Kestrun module
Install-PSResource -Name Kestrun

# Initialize Kestrun root directory
# the default value is $PWD
# This is recommended in order to use relative paths without issues
Initialize-KrRoot -Path $PSScriptRoot

# Create a new Kestrun server
New-KrServer -Name "Simple Server"

# Add a listener on port 5000 and IP address 127.0.0.1 (localhost)
Add-KrListener -Port 5000 -IPAddress ([IPAddress]::Loopback)

# Define the content type map to add to the default set
$map = @{
   ".yaml" = "application/x-yaml"
   ".yml"  = "application/x-yaml"
   ".ps1"  = "text/plain"   # treat PowerShell scripts as plain text for safe viewing
}

# Add a file server with browsing enabled and custom content types
Add-KrFileServer -RequestPath '/' -RootPath '.\Assets\wwwroot' -EnableDirectoryBrowsing -ContentTypeMap $map

# Enable Kestrun configuration
Enable-KrConfiguration

# Start the server asynchronously
Start-KrServer
```

## Step-by-step

1. Root initialization: `Initialize-KrRoot` ensures `'.\Assets\wwwroot'` is resolved relative to the script.
2. Listener: same loopback listener as earlier samples.
3. Content type mapping: A hashtable `$map` extends builtâ€‘in MIME mappings (e.g., adds YAML, forces `.ps1` to
   `text/plain` so scripts display rather than download/execute).
4. File server registration: `Add-KrFileServer -RequestPath '/' ... -ContentTypeMap $map` mounts the root of
   the hosted site and applies the custom provider.
5. Directory browsing: `-EnableDirectoryBrowsing` renders an HTML listing when a request targets a directory
   without a default document.
6. Start & serve: `Enable-KrConfiguration` then `Start-KrServer` activates the service.

## File Server vs Static Files Service

| Aspect                | `Add-KrStaticFilesService`                           | `Add-KrFileServer`                                           |
|-----------------------|------------------------------------------------------|--------------------------------------------------------------|
| Purpose               | Serve static files under a path prefix               | Serve files and optionally list directories                  |
| Directory listing     | Not built-in                                         | Supported via `-EnableDirectoryBrowsing`                     |
| Typical mount path    | A sub-path (e.g., `/assets`)                         | Root (`/`) or sub-path needing browsing                      |
| Minimal configuration | `-RequestPath` + `-RootPath`                         | Same, plus optional browsing flag                            |
| Custom MIME map       | Via options object (advanced)                        | Simple `-ContentTypeMap` hashtable parameter                 |
| Serve unknown types   | Flag available (`-ServeUnknownFileTypes` on options) | `-ServeUnknownFileTypes` switch (use sparingly)              |
| Use case              | Performance asset bundle                             | File repository / docs / ad-hoc downloads / exploratory dirs |

Choose `Add-KrStaticFilesService` for performance-focused asset hosting (no listing page). Choose
`Add-KrFileServer` when you want users to navigate folders or you need a quick file drop.

## Try it

### Start the server

```powershell
pwsh .\examples\PowerShell\Tutorial\3.2-File-Server.ps1
```

### Browse

Open <http://127.0.0.1:5000/> in a browser. You should see an index (listing) including the sample files you created
under `Assets/wwwroot` (e.g., `/files/sample.txt`, `/files/data.json`, images, docs, etc.). YAML files should now show
`Content-Type: application/x-yaml` and `.ps1` files as `text/plain` per the mapping.

### Fetch examples (PowerShell)

```powershell
Invoke-WebRequest -Uri 'http://127.0.0.1:5000/files/sample.txt' | Select-Object -ExpandProperty Content
Invoke-WebRequest -Uri 'http://127.0.0.1:5000/files/data.json' | Select-Object -ExpandProperty Content
```

## Security considerations

- Mount only directories intended for public access.
- Exclude secrets/build artifacts from the root path.
- For large directories disable browsing in production unless needed.

## Troubleshooting

| Symptom                     | Cause                              | Fix                                                                            |
|-----------------------------|------------------------------------|--------------------------------------------------------------------------------|
| 404 for expected file       | Wrong path or root misconfigured   | Verify physical file exists under `RootPath`; check `Initialize-KrRoot` usage. |
| Directory listing not shown | `-EnableDirectoryBrowsing` omitted | Re-register service with the flag or add it.                                   |
| Incorrect MIME type         | Unrecognized extension             | Add a custom mapping if supported or rename file with standard extension.      |
| Access to parent dirs       | Attempt to traverse with `..`      | Requests should be safely rooted; ensure latest version if traversal appears.  |

## Cmdlet references

- [Add-KrFileServer][Add-KrFileServer]
- [Initialize-KrRoot][Initialize-KrRoot]
- [Add-KrListener][Add-KrListener]
- [New-KrServer][New-KrServer]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Start-KrServer][Start-KrServer]
- [Add-KrStaticFilesService][Add-KrStaticFilesService]

---

### Next

{: .fs-4 .fw-500}

Previous: [Serving Static Files](./1.Static-Routes)  
Next: [Static Route Overrides](./3.Static-Override-Routes)  
Or continue to [Variable Routes][Next].

[Add-KrFileServer]: /docs/pwsh/cmdlets/Add-KrFileServer
[Add-KrStaticFilesService]: /docs/pwsh/cmdlets/Add-KrStaticFilesService
[Initialize-KrRoot]: /docs/pwsh/cmdlets/Initialize-KrRoot
[Add-KrListener]: /docs/pwsh/cmdlets/Add-KrListener
[New-KrServer]: /docs/pwsh/cmdlets/New-KrServer
[Enable-KrConfiguration]: /docs/pwsh/cmdlets/Enable-KrConfiguration
[Start-KrServer]: /docs/pwsh/cmdlets/Start-KrServer
[3.2-File-Server.ps1]: https://github.com/Kestrun/Kestrun/blob/main/examples/PowerShell/Tutorial/3.2-File-Server.ps1
[Introduction]: ../1.introduction/index#prerequisites
[Next]: ../4.variable/index
