---
title: Static Route Overrides
parent: Static Routes
nav_order: 3
---

# Static Route Overrides

Inject dynamic responses at specific file paths under a static directory.

> Prerequisites: see [Introduction][Introduction].

## Full source

File: [`pwsh/tutorial/examples/3.3-Static-OverrideRoutes.ps1`][3.3-Static-OverrideRoutes.ps1]

```powershell
{% include examples/pwsh/3.3-Static-OverrideRoutes.ps1 %}
```

## Step-by-step

1. Initialize root: `Initialize-KrRoot -Path $PSScriptRoot` for reliable relative paths.
2. Create server and listener: `New-KrServer`; `Add-KrListener -Port 5000 -IPAddress Loopback`.
3. Enable PowerShell runtime: `Add-KrPowerShellRuntime` so PS routes and middlewares run.
4. Register static files: `Add-KrStaticFilesService -RequestPath '/assets' -RootPath '.\\Assets\\wwwroot'`.
5. Add override: `Add-KrStaticMapOverride -Path '/assets/override/pwsh'` with a script block returning JSON.
6. Apply config and start: `Enable-KrConfiguration`; then `Start-KrServer`.

## Try it

Save the sample locally so it’s easy to run. Copy the contents of
[`pwsh/tutorial/examples/3.3-Static-OverrideRoutes.ps1`][3.3-Static-OverrideRoutes.ps1]
into a new file in an empty working folder (for example, `override-routes.ps1`), then run:

```powershell
# From your working folder
pwsh .\override-routes.ps1
curl http://127.0.0.1:5000/assets/override/pwsh
Invoke-RestMethod -Uri 'http://127.0.0.1:5000/assets/override/pwsh'
```

Expected JSON:

```json
{ "status": "ok", "message": "Static override works!" }
```

## Why use an override?

- Add a health or status JSON under a static prefix (e.g., `/assets/status`).
- Replace a generated config file without changing the build output.
- Rapid prototyping: deliver dynamic snippets alongside static SPA assets.

## Behavior and precedence

- Path match is exact against the full request path.
- An override takes precedence over a file of the same path under the static root.
- If no override exists the physical file (if present) is served.

### (Optional) Create a file to test precedence

Create a physical file at `Assets/wwwroot/override/pwsh` and restart the script. The override still wins.
Remove the override line (or comment it out), restart, and the physical file will be served instead.

## Best practices

- Keep override script blocks small and fast (avoid long-running logic).
- Use descriptive paths (e.g., `/assets/health`, `/assets/meta/info`).
- Avoid large dynamic payloads; prefer a dedicated API route (`Add-KrMapRoute`) for complex behavior.
- Document override locations so future maintainers understand why a file path is dynamic.

## Troubleshooting

| Symptom                              | Cause                                | Fix                                                                             |
|--------------------------------------|--------------------------------------|---------------------------------------------------------------------------------|
| Exception when adding override       | Added after `Enable-KrConfiguration` | Move `Add-KrStaticMapOverride` earlier (before enabling).                       |
| 404 Not Found                        | Path mismatch or missing static base | Verify path starts with mounted prefix `/assets` and static service registered. |
| Physical file served instead of JSON | Override removed or path typo        | Re-add override with correct path; ensure leading `/`.                          |
| Unexpected content type              | Response helper not used             | Use `Write-KrJsonResponse` / `Write-KrTextResponse` as appropriate.             |

## When to choose an override vs a normal route

| Scenario                                   | Override (`Add-KrStaticMapOverride`) | Standard route (`Add-KrMapRoute`) |
|--------------------------------------------|--------------------------------------|-----------------------------------|
| Integrate dynamic JSON under static prefix | ✔                                    | Possible (but separate path tree) |
| Need route outside static prefix           | ✖ (not needed)                       | ✔                                 |
| Replace/augment a single file path         | ✔                                    | Indirect (different URL)          |
| Many related dynamic endpoints             | Less ideal                           | ✔ (group them normally)           |

## Cmdlet references

- [Add-KrStaticMapOverride][Add-KrStaticMapOverride]
- [Add-KrStaticFilesService][Add-KrStaticFilesService]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrListener][Add-KrListener]
- [New-KrServer][New-KrServer]
- [Start-KrServer][Start-KrServer]

---

### Next

{: .fs-4 .fw-500}

Previous: [File Server & Directory Browsing](./2.File-Server)
Next: [Adding a Favicon](./4.Favicon)
Skip ahead: [Variable Routes](../4.variable/index)

[3.3-Static-OverrideRoutes.ps1]: /pwsh/tutorial/examples/3.3-Static-OverrideRoutes.ps1
[Add-KrStaticMapOverride]: /pwsh/cmdlets/Add-KrStaticMapOverride
[Add-KrStaticFilesService]: /pwsh/cmdlets/Add-KrStaticFilesService
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrListener]: /pwsh/cmdlets/Add-KrListener
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[Introduction]: ../1.introduction/index#prerequisites
