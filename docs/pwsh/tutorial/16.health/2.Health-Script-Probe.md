---
title: Script Probe
parent: Health
nav_order: 2
---

# Script Probe

Demonstrates a standalone PowerShell script probe measuring latency and producing custom metrics.

## Full source

File: [`pwsh/tutorial/examples/16.2-Health-Script-Probe.ps1`][16.2-Health-Script-Probe.ps1]

```powershell
{% include examples/pwsh/16.2-Health-Script-Probe.ps1 %}
```

## Step-by-step

1. Register a script-based probe with `Add-KrScriptProbe`.
2. Create a `ProbeResult` using [New-KrProbeResult][New-KrProbeResult] and include timing metrics.
3. Assign tags to allow filtering via `?tag=perf`.
4. Start the server and query `/healthz`.

## Try it

Start the script, then:

```powershell
Invoke-RestMethod http://127.0.0.1:5001/healthz | ConvertTo-Json -Depth 4
Invoke-RestMethod 'http://127.0.0.1:5001/healthz?tag=perf' | ConvertTo-Json -Depth 4
```

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| Probe reports `Unhealthy` unexpectedly | Threshold logic too strict | Adjust thresholds or widen degraded window |
| Missing custom metrics in JSON | Data dictionary not populated | Ensure you assign keys before returning result |

[16.2-Health-Script-Probe.ps1]: /pwsh/tutorial/examples/16.2-Health-Script-Probe.ps1

## References

- [Add-KrScriptProbe][Add-KrScriptProbe]
- [New-KrProbeResult][New-KrProbeResult]
- [Add-KrHealthEndpoint][Add-KrHealthEndpoint]

[Add-KrScriptProbe]: /pwsh/cmdlets/Add-KrScriptProbe
[New-KrProbeResult]: /pwsh/cmdlets/New-KrProbeResult
[Add-KrHealthEndpoint]: /pwsh/cmdlets/Add-KrHealthEndpoint

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [Health Quickstart](./1.Health-Quickstart.md)
Next: [HTTP Probe](./3.Health-Http-Probe)
