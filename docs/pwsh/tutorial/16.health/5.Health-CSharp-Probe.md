---
title: C# Inline Probe
parent: Health
nav_order: 5
---

# C# Inline Probe

Illustrates using the C# inline capability to craft a probe in code when PowerShell alone is insufficient or you want direct .NET API access.

## Full source

File: [`pwsh/tutorial/examples/16.5-Health-CSharp-Probe.ps1`][16.5-Health-CSharp-Probe.ps1]

```powershell
{% include examples/pwsh/16.5-Health-CSharp-Probe.ps1 %}
```

## Key Points

- `-ScriptBlock` still used; inside you can create delegate probes or just return a `ProbeResult`.
- Example randomizes status to demonstrate all states.
- Rich objects (e.g., exception info) can be serialized into the data bag.

## Try It

```powershell
Invoke-RestMethod http://127.0.0.1:5004/healthz | ConvertTo-Json -Depth 4
```

Run multiple times to observe varying statuses.

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| Compilation error | Inline C# syntax issue | Validate C# snippet separately before embedding |
| Missing data fields | Not added to dictionary | Ensure dictionary keys are set before returning result |

## Cmdlet references

- [New-KrLogger][New-KrLogger]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Add-KrPowerShellRuntime][Add-KrPowerShellRuntime]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrHealthProbe][Add-KrHealthProbe]
- [Add-KrHealthEndpoint][Add-KrHealthEndpoint]
- [Start-KrServer][Start-KrServer]
- [New-KrProbeResult][New-KrProbeResult]

[16.5-Health-CSharp-Probe.ps1]: /pwsh/tutorial/examples/16.5-Health-CSharp-Probe.ps1
[New-KrLogger]: /pwsh/cmdlets/New-KrLogger
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Add-KrPowerShellRuntime]: /pwsh/cmdlets/Add-KrPowerShellRuntime
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrHealthProbe]: /pwsh/cmdlets/Add-KrHealthProbe
[Add-KrHealthEndpoint]: /pwsh/cmdlets/Add-KrHealthEndpoint
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[New-KrProbeResult]: /pwsh/cmdlets/New-KrProbeResult
