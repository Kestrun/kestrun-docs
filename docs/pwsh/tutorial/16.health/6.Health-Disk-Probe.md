---
title: Disk Probe
parent: Health
nav_order: 6
---

# Disk Probe

Demonstrates the built‑in disk space probe (auto‑registered) and how to override it with custom thresholds.

## Full source

File: [`pwsh/tutorial/examples/16.6-Health-Disk-Probe.ps1`][16.6-Health-Disk-Probe.ps1]

```powershell
{% include examples/pwsh/16.6-Health-Disk-Probe.ps1 %}
```

## Step-by-step

1. Use the default disk probe or override it by registering a probe with the same name.
2. Set thresholds for Healthy/Degraded/Unhealthy.
3. Include percentage and byte metrics in the data for dashboards.
4. Start the server and query `/healthz`.

## Try It

```powershell
Invoke-RestMethod http://127.0.0.1:5005/healthz | ConvertTo-Json -Depth 4
```

## Override Strategy

Use scripted logic to tailor thresholds for specific disks or mount points. You can also add
multiple disk probes differentiated by name (e.g., `disk-root`, `disk-data`).

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| Always Healthy | Thresholds too low | Tighten degraded/unhealthy cutoffs |
| Probe missing | Override failed | Ensure names match (`disk`) |

## References

- [New-KrLogger][New-KrLogger]
- [New-KrServer][New-KrServer]
- [Add-KrEndpoint][Add-KrEndpoint]
- [Enable-KrConfiguration][Enable-KrConfiguration]
- [Add-KrHealthProbe][Add-KrHealthProbe]
- [Add-KrHealthEndpoint][Add-KrHealthEndpoint]
- [Start-KrServer][Start-KrServer]
- [New-KrProbeResult][New-KrProbeResult]

[16.6-Health-Disk-Probe.ps1]: /pwsh/tutorial/examples/16.6-Health-Disk-Probe.ps1
[New-KrLogger]: /pwsh/cmdlets/New-KrLogger
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrEndpoint]: /pwsh/cmdlets/Add-KrEndpoint
[Enable-KrConfiguration]: /pwsh/cmdlets/Enable-KrConfiguration
[Add-KrHealthProbe]: /pwsh/cmdlets/Add-KrHealthProbe
[Add-KrHealthEndpoint]: /pwsh/cmdlets/Add-KrHealthEndpoint
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
[New-KrProbeResult]: /pwsh/cmdlets/New-KrProbeResult

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [C# Probe](./5.Health-CSharp-Probe)
Next: [Response Format](./7.Health-Response-Format)
