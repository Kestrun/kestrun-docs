---
title: Generate a CSR (Certificate Signing Request)
parent: Certificates
nav_order: 2
---

# Generate a CSR (Certificate Signing Request)

Run a small API that generates a CSR from request parameters.

## Full source

```powershell
{% include examples/pwsh/6.2-Cert-CSR.ps1 %}
```

## Step-by-step

1. Initialize root: `Initialize-KrRoot -Path $PSScriptRoot` to make relative paths predictable.
2. Logging: create and register a default console logger at Debug to trace inputs/outputs.
3. Server: `New-KrServer -Name 'CSR API'` creates a host instance.
4. Listener: bind to `127.0.0.1:5000` with `Add-KrEndpoint -Port 5000 -IPAddress Loopback`.
5. Enable configuration: commit staged changes with `Enable-KrConfiguration`.
6. Apply config: `Enable-KrConfiguration` commits staged settings.
7. Map route: `Add-KrMapRoute -Verbs Post -Pattern '/certs/csr'` handles CSR requests.
8. Parse input (JSON body):
    - `DnsNames`: string or array of strings. Normalized to an array.
    - `KeyType`: `Rsa` or `Ecdsa` (string; case-insensitive recommended).
    - `KeyLength`: integer. Common: 2048 for RSA; 256/384/521 for ECDSA.
    - `Country`, `Org`, `CommonName`: optional subject fields.
9. Generate CSR: call [New-KrCertificateRequest][New-KrCertificateRequest] with the assembled parameters. Debug logs capture
    the request and result objects.
10. Respond JSON with:
     - `csrPem`: PEM-encoded CSR
     - `privateKeyPem`: PEM-encoded private key for the CSR
     - `publicKeyPem`: PEM-encoded public key derived from the request
11. Errors: on validation or parameter errors, return HTTP 400 with `{ error: <message> }`.
12. Start server: `Start-KrServer` begins processing requests.

## Try it

Save the sample locally so it’s easy to run. Copy the contents of
[`pwsh/tutorial/examples/6.2-Cert-CSR.ps1`](pwsh/tutorial/examples/6.2-Cert-CSR.ps1)
into a new file in an empty working folder (for example, `cert-csr.ps1`), then run:

```powershell
# From your working folder
pwsh .\cert-csr.ps1
curl -X POST http://127.0.0.1:5000/certs/csr -H "Content-Type: application/json" `
    -d '{"DnsNames":["example.com"],"KeyType":"Ecdsa","KeyLength":384,"Country":"US","Org":"Acme Ltd.","CommonName":"example.com"}'

Invoke-RestMethod -Method Post -Uri 'http://127.0.0.1:5000/certs/csr' -ContentType 'application/json' -Body (@{
    DnsNames = @('example.com'); KeyType = 'Ecdsa'; KeyLength = 384; Country = 'US'; Org = 'Acme Ltd.'; CommonName = 'example.com'
} | ConvertTo-Json)

# (Optional) Save returned PEMs
# $resp = Invoke-RestMethod -Method Post -Uri 'http://127.0.0.1:5000/certs/csr' -ContentType 'application/json' -Body (@{
#   DnsNames = @('example.com'); KeyType = 'Ecdsa'; KeyLength = 384; Country = 'US'; Org = 'Acme Ltd.'; CommonName = 'example.com'
# } | ConvertTo-Json)
# $resp.csrPem        | Set-Content -Path './example-com.csr' -NoNewline
# $resp.privateKeyPem | Set-Content -Path './example-com.key' -NoNewline
# $resp.publicKeyPem  | Set-Content -Path './example-com.pub' -NoNewline
```

## Troubleshooting

| Symptom                  | Cause                         | Fix                                                                 |
|--------------------------|-------------------------------|---------------------------------------------------------------------|
| 400 Bad Request          | Missing/invalid input fields  | Provide required fields; check KeyType/KeyLength validity           |
| Wrong key algorithm      | Case mismatch in `KeyType`    | Use `Rsa` or `Ecdsa` (case-insensitive recommended)                 |
| Empty PEM fields         | CSR generation failed         | Inspect logs; ensure parameters map to `New-KrCertificateRequest`   |
| Server not reachable     | Port blocked/in use           | Use loopback 127.0.0.1:5000 and verify nothing else uses the port   |

## References

- [New-KrCertificateRequest][New-KrCertificateRequest]

---

### Previous / Next

{: .fs-4 .fw-500}

Go back to [Self‑Signed][Previous] or continue to [Import / Export / Validate][Next].

[Previous]: ./1.Self-Signed
[Next]: ./3.Import-Export-Validate

[New-KrCertificateRequest]: /pwsh/cmdlets/New-KrCertificateRequest
