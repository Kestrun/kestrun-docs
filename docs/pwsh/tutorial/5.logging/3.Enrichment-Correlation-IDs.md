---
title: Enrichment & Correlation IDs
parent: Logging
nav_order: 3
---

# Enrichment & Correlation IDs

Attach useful properties (enrichment) to your log events and add a per-request
correlation ID so you can trace a single request across multiple log lines
and even across languages (PowerShell and C# routes).

> See the [Logging guide](/guides/logging) for in-depth enrichment options and Serilog helpers.

## Full source

File: [`docs/_includes/examples/pwsh/5.3-Enrichment-Correlation-IDs.ps1`][5.3-Enrichment-Correlation-IDs.ps1]

```powershell
{% include examples/pwsh/5.3-Enrichment-Correlation-IDs.ps1 %}
```

## Step-by-step

1. Build a logger with minimum `Debug`, add a global property `App`, and sinks (console + file).
2. Standard server, listener, PowerShell runtime; then `Enable-KrConfiguration`.
3. PowerShell route `/ps-correlation`:
   - Generate a correlation ID per request (`[guid]::NewGuid().ToString('N')`).
   - Attach it via `-Properties @{ CorrelationId = $corr }` on each `Write-KrLog`.
4. C# route `/csharp-correlation`:
   - Share the logger into the code route via `-UsingVariables`.
   - Use Serilog `ForContext("CorrelationId", id)` to enrich subsequent events.
5. Start with `Start-KrServer`.

## Try it

### Start the server

```powershell
pwsh .\docs\_includes\examples\pwsh\5.3-Enrichment-Correlation-IDs.ps1
```

### Issue some requests

```powershell
curl http://127.0.0.1:5002/ps-correlation
curl http://127.0.0.1:5002/csharp-correlation
```

### View logs

```powershell
Get-Content .\logs\enrichment.log -Tail 40
```

Expected: Each request shows a unique `CorrelationId` on all events for that request.

## Customizing

- Add more properties globally with `Add-KrProperty` (e.g., `Environment`, `Version`).
- Use Serilog enrichers (machine name, thread id, etc.).
- Consider setting a request header (e.g., `X-Correlation-Id`) and reusing it if present.
- To enable Kestrun framework logs, set your logger as default or pass it via `New-KrServer`.

## Troubleshooting

| Symptom                              | Cause                             | Fix                                             |
|--------------------------------------|-----------------------------------|-------------------------------------------------|
| No CorrelationId appears in events   | Property name mismatch            | Ensure key is exactly `CorrelationId`           |
| Different IDs in one requestâ€™s lines | New GUID generated per log call   | Generate once per request and reuse             |
| No logs written                      | Minimum level too high / bad path | Lower minimum; verify file path and permissions |

## Cmdlet references

- [New-KrLogger][New-KrLogger]
- [Set-KrMinimumLevel][Set-KrMinimumLevel]
- [Add-KrProperty][Add-KrProperty]
- [Add-KrSinkFile][Add-KrSinkFile]
- [Add-KrSinkConsole][Add-KrSinkConsole]
- [Register-KrLogger][Register-KrLogger]
- [Write-KrLog][Write-KrLog]
- [New-KrServer][New-KrServer]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Start-KrServer][Start-KrServer]

---

### Next

{: .fs-4 .fw-500}

Previous: [Multiple Loggers & Levels](./2.Multiple-Loggers-Levels)
Next: [Sinks (Console/File/JSON)](./4.Sinks)
Guide: [Logging (Concepts)](/guides/logging)

[5.3-Enrichment-Correlation-IDs.ps1]: /_includes/examples/pwsh/5.3-Enrichment-Correlation-IDs.ps1
[New-KrLogger]: /pwsh/cmdlets/New-KrLogger
[Set-KrMinimumLevel]: /pwsh/cmdlets/Set-KrMinimumLevel
[Add-KrProperty]: /pwsh/cmdlets/Add-KrProperty
[Add-KrSinkFile]: /pwsh/cmdlets/Add-KrSinkFile
[Add-KrSinkConsole]: /pwsh/cmdlets/Add-KrSinkConsole
[Register-KrLogger]: /pwsh/cmdlets/Register-KrLogger
[Write-KrLog]: /pwsh/cmdlets/Write-KrLog
[New-KrServer]: /pwsh/cmdlets/New-KrServer
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Start-KrServer]: /pwsh/cmdlets/Start-KrServer
