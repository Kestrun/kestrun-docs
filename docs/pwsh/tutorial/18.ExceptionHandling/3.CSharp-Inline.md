---
title: C# Inline Handler
parent: Exception Handling
nav_order: 3
---

# C# Inline Handler

Handle exceptions with a C# inline handler. Useful when your app exposes C# routes but you still want consistent JSON errors.

## Full source

File: [`pwsh/tutorial/examples/18.3-ExceptionHandling-CSharp.ps1`][18.3-ExceptionHandling-CSharp.ps1]

```powershell
{% include examples/pwsh/18.3-ExceptionHandling-CSharp.ps1 %}
```

## Step-by-step

1. Logger: Configure console logger.
2. Server: Create and listen on 127.0.0.1:5000.
3. Middleware: Enable exception handling with `-Code` in C# and `-Language CSharp`.
4. Route: Map `/fail` that throws in C# to trigger the middleware.
5. Response: The handler writes structured JSON with `error`, `message`, `path`, and `method`.
6. Start: Apply configuration and start.

## Try it

```powershell
curl -i http://127.0.0.1:5000/fail
```

PowerShell:

```powershell
Invoke-WebRequest -Uri http://127.0.0.1:5000/fail -UseBasicParsing -SkipHttpErrorCheck |
  Select-Object StatusCode,@{n='ContentType';e={$_.Headers['Content-Type']}},Content
```

## Troubleshooting

- Getting text/plain instead of application/json? Ensure your handler sets the content type.
- Missing fields in JSON? Verify your C# code writes all keys (`error`, `message`, `path`, `method`).

## References

- [Enable-KrExceptionHandling][Enable-KrExceptionHandling]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Write-KrJsonResponse][Write-KrJsonResponse]

---

### Previous / Next

{: .fs-4 .fw-500}

Previous: [VB.Net Handler](./2.VBNet-Handler.md)
Next: [ProblemDetails Fallback](./4.ProblemDetails.md)

[18.3-ExceptionHandling-CSharp.ps1]: /pwsh/tutorial/examples/18.3-ExceptionHandling-CSharp.ps1
[Enable-KrExceptionHandling]: /pwsh/cmdlets/Enable-KrExceptionHandling
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
