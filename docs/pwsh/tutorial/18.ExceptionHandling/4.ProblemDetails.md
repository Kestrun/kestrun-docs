---
title: ProblemDetails Fallback
parent: Exception Handling
nav_order: 4
---

# ProblemDetails Fallback

Return RFC 7807 ProblemDetails for unhandled exceptions, ideal for API clients.

## Full source

File: [`pwsh/tutorial/examples/18.4-ExceptionHandling-ProblemDetails.ps1`][18.4-ExceptionHandling-ProblemDetails.ps1]

```powershell
{% include examples/pwsh/18.4-ExceptionHandling-ProblemDetails.ps1 %}
```

## Step-by-step

1. Logger: Register console logger.
2. Server: Create and listen on 127.0.0.1:5000.
3. Middleware: `Enable-KrExceptionHandling -UseProblemDetails` to emit standardized JSON.
4. Route: Map `/oops` that throws to exercise the handler.
5. Response: 500 status with ProblemDetails fields like `type`, `title`, `status`, and `traceId`.
6. Start: Apply configuration and start.

## Try it

```powershell
curl -i http://127.0.0.1:5000/oops
```

PowerShell:

```powershell
$r = Invoke-WebRequest -Uri http://127.0.0.1:5000/oops -UseBasicParsing -SkipHttpErrorCheck
try { $json = $r.Content | ConvertFrom-Json -AsHashtable } catch { $json = $null }
$r.StatusCode
$json
```

## Troubleshooting

- Client can't parse JSON? Some clients receive gzipped content; ensure decompression or disable gzip for debugging.
- Getting generic 500 text? Confirm `-UseProblemDetails` is enabled and nothing overwrote the response later in the pipeline.

## References

- [Enable-KrExceptionHandling][Enable-KrExceptionHandling]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [RFC 7807][RFC 7807]

---

### Previous / Next

Previous: [C# Inline Handler](./3.CSharp-Inline.md)
Next: [Developer Exception Page](./5.Developer-Exception-Page.md)

[18.4-ExceptionHandling-ProblemDetails.ps1]: /pwsh/tutorial/examples/18.4-ExceptionHandling-ProblemDetails.ps1
[Enable-KrExceptionHandling]: /pwsh/cmdlets/Enable-KrExceptionHandling
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[RFC 7807]: https://datatracker.ietf.org/doc/html/rfc7807
