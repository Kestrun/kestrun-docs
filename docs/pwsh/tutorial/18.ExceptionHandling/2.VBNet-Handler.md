---
title: VB.NET Handler
parent: Exception Handling
nav_order: 2
---

# VB.NET Handler

Handle exceptions using a VB.NET middleware handler for consistent JSON across routes.

## Full source

File: [`pwsh/tutorial/examples/18.2-ExceptionHandling-VBNet.ps1`][18.2-ExceptionHandling-VBNet.ps1]

```powershell
{% include examples/pwsh/18.2-ExceptionHandling-VBNet.ps1 %}
```

## Step-by-step

1. Logging: Register console logger as default.
2. Server: Create server and listen on loopback.
3. Middleware: Register `Enable-KrExceptionHandling -Code $vbCode -Language VBNet`.
4. Routes: Map `/ok`, `/oops` (PowerShell throw), and `/csharp-error` (C# inline throw).
5. Response: Middleware formats exceptions into JSON with `error`, `message`, `path`, and `method`.
6. Start: Apply configuration and start the server.

## Try it

```powershell
# OK
curl -i http://127.0.0.1:5000/ok

# PowerShell exception (handled by VB.NET middleware)
curl -i http://127.0.0.1:5000/oops

# C# exception (handled by VB.NET middleware)
curl -i http://127.0.0.1:5000/csharp-error
```

PowerShell equivalents:

```powershell
Invoke-WebRequest -Uri http://127.0.0.1:5000/ok -UseBasicParsing | Select-Object StatusCode, Content
Invoke-WebRequest -Uri http://127.0.0.1:5000/oops -UseBasicParsing -SkipHttpErrorCheck | Select-Object StatusCode, Content
Invoke-WebRequest -Uri http://127.0.0.1:5000/csharp-error -UseBasicParsing -SkipHttpErrorCheck | Select-Object StatusCode, Content
```

## Troubleshooting

- Getting plain text instead of JSON? Ensure the VB.NET handler uses `Context.Response.WriteJsonResponse(...)` and sets a 500 status.
- Not seeing `path` or `method`? Include them in the anonymous object in the VB.NET code.

## References

- [Enable-KrExceptionHandling][Enable-KrExceptionHandling]
- [Add-KrMapRoute][Add-KrMapRoute]
- [Write-KrJsonResponse][Write-KrJsonResponse]
- [Write-KrTextResponse][Write-KrTextResponse]

---

### Previous / Next

Previous: [Exception Handling to Path](./1.ExceptionHandlingPath.md)
Next: [C# Inline Handler](./3.CSharp-Inline.md)

[18.2-ExceptionHandling-VBNet.ps1]: /pwsh/tutorial/examples/18.2-ExceptionHandling-VBNet.ps1
[Enable-KrExceptionHandling]: /pwsh/cmdlets/Enable-KrExceptionHandling
[Add-KrMapRoute]: /pwsh/cmdlets/Add-KrMapRoute
[Write-KrJsonResponse]: /pwsh/cmdlets/Write-KrJsonResponse
[Write-KrTextResponse]: /pwsh/cmdlets/Write-KrTextResponse
